"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[73059],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var r=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=r.createContext({}),s=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=s(a),k=o,m=u["".concat(l,".").concat(k)]||u[k]||d[k]||n;return a?r.createElement(m,i(i({ref:t},c),{},{components:a})):r.createElement(m,i({ref:t},c))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,i=new Array(n);i[0]=k;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[u]="string"==typeof e?e:o,i[1]=p;for(var s=2;s<n;s++)i[s]=a[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}k.displayName="MDXCreateElement"},99009:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>n,metadata:()=>p,toc:()=>s});var r=a(87462),o=(a(67294),a(3905));const n={title:"New python package to Fedora",authors:["jscotka","jpopelka"]},i=void 0,p={unversionedId:"user-stories/python_project_from_scratch",id:"user-stories/python_project_from_scratch",title:"New python package to Fedora",description:"A guide for complete newbies about what it takes to incorporate a python package to fedora from Packit project perspective.",source:"@site/research/user-stories/python_project_from_scratch.md",sourceDirName:"user-stories",slug:"/user-stories/python_project_from_scratch",permalink:"/research/user-stories/python_project_from_scratch",draft:!1,editUrl:"https://github.com/packit/research/tree/main/research/user-stories/python_project_from_scratch.md",tags:[],version:"current",frontMatter:{title:"New python package to Fedora",authors:["jscotka","jpopelka"]},sidebar:"autogenerated",previous:{title:"User Stories",permalink:"/research/user-stories/"},next:{title:"Summit 2020 Demo",permalink:"/research/user-stories/summit-demo"}},l={},s=[{value:"Prerequsities",id:"prerequsities",level:2},{value:"Create python package",id:"create-python-package",level:3},{value:"Decide and setup versioning schema",id:"decide-and-setup-versioning-schema",level:3},{value:"Upload package release to PYPI",id:"upload-package-release-to-pypi",level:3},{value:"Workflow to enable COPR builds of your packages",id:"workflow-to-enable-copr-builds-of-your-packages",level:2},{value:"Create Specfile",id:"create-specfile",level:3},{value:"Install Packit-as-a-Service GitHub App",id:"install-packit-as-a-service-github-app",level:3},{value:"Create .packit.yaml with copr build enabled",id:"create-packityaml-with-copr-build-enabled",level:3},{value:"Increase version and push it to git/PYPI already",id:"increase-version-and-push-it-to-gitpypi-already",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Workflow to add your package to Fedora",id:"workflow-to-add-your-package-to-fedora",level:2},{value:"Became Fedora package maintainer",id:"became-fedora-package-maintainer",level:3},{value:"Contribute new package to Fedora",id:"contribute-new-package-to-fedora",level:3}],c={toc:s},u="wrapper";function d(e){let{components:t,...a}=e;return(0,o.kt)(u,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"A guide for complete newbies about what it takes to incorporate a python package to fedora from Packit project perspective."),(0,o.kt)("h2",{id:"prerequsities"},"Prerequsities"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You have python project on ",(0,o.kt)("a",{parentName:"li",href:"https://github.com"},"Github"),".")),(0,o.kt)("h3",{id:"create-python-package"},"Create python package"),(0,o.kt)("p",null,"Create ",(0,o.kt)("inlineCode",{parentName:"p"},"setup.py")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"setup.cfg")," with a package metadata.\n",(0,o.kt)("inlineCode",{parentName:"p"},"setup.{py|cfg}")," is the build script for ",(0,o.kt)("a",{parentName:"p",href:"https://setuptools.readthedocs.io/en/latest/setuptools.html"},"setuptools"),"."),(0,o.kt)("h3",{id:"decide-and-setup-versioning-schema"},"Decide and setup versioning schema"),(0,o.kt)("p",null,"You can either manually set version in ",(0,o.kt)("inlineCode",{parentName:"p"},"setup.py")," or let ",(0,o.kt)("a",{parentName:"p",href:"https://pypi.org/project/setuptools-scm"},"setuptools-scm")," do that for you."),(0,o.kt)("p",null,"Choose your scheme, eg ",(0,o.kt)("inlineCode",{parentName:"p"},"0.1.0"),".\nIt depends on previous steps, if you have hardcoded version in ",(0,o.kt)("inlineCode",{parentName:"p"},"setup.py"),", or used mechanism like git tags"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create git tag ",(0,o.kt)("inlineCode",{parentName:"li"},"git tag 0.1.0 -a"),", then python setup will use this as version"),(0,o.kt)("li",{parentName:"ul"},"Push the tag to origin ",(0,o.kt)("inlineCode",{parentName:"li"},"git push --tags")),(0,o.kt)("li",{parentName:"ul"},"Use ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/dgoodwin/tito"},"tito")," project to increase versions")),(0,o.kt)("h3",{id:"upload-package-release-to-pypi"},"Upload package release to PYPI"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you are not already registered, register to ",(0,o.kt)("a",{parentName:"li",href:"https://pypi.org/account/register/"},"PYPI server")),(0,o.kt)("li",{parentName:"ul"},"Build the package ",(0,o.kt)("inlineCode",{parentName:"li"},"python3 setup.py sdist")),(0,o.kt)("li",{parentName:"ul"},"Install twine: ",(0,o.kt)("inlineCode",{parentName:"li"},"sudo dnf install python3-twine")),(0,o.kt)("li",{parentName:"ul"},"Upload release: ",(0,o.kt)("inlineCode",{parentName:"li"},"twine upload dist/your_package_name-0.1.0.tar.gz"))),(0,o.kt)("h2",{id:"workflow-to-enable-copr-builds-of-your-packages"},"Workflow to enable COPR builds of your packages"),(0,o.kt)("h3",{id:"create-specfile"},"Create Specfile"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Install ",(0,o.kt)("a",{parentName:"li",href:"https://pypi.org/project/pyp2rpm/"},"pyp2rpm")," to convert your ",(0,o.kt)("inlineCode",{parentName:"li"},"setup.py")," to a specfile: ",(0,o.kt)("inlineCode",{parentName:"li"},"sudo dnf install pyp2rpm")),(0,o.kt)("li",{parentName:"ul"},"Create specfile: ",(0,o.kt)("inlineCode",{parentName:"li"},"pyp2rpm your_project_name > python-your_project_name.spec")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pyp2rpm")," creates also section ",(0,o.kt)("inlineCode",{parentName:"li"},"%check")," in your specfile. It may cause troubles in case you have no defined ",(0,o.kt)("inlineCode",{parentName:"li"},"test")," in your setup.py, so replace it with your test command, or remove this section.")),(0,o.kt)("h3",{id:"install-packit-as-a-service-github-app"},"Install Packit-as-a-Service GitHub App"),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"https://packit.dev/packit-as-a-service"},"documentation"),"."),(0,o.kt)("h3",{id:"create-packityaml-with-copr-build-enabled"},"Create .packit.yaml with copr build enabled"),(0,o.kt)("p",null,"Comprehensive documentation is available at ",(0,o.kt)("a",{parentName:"p",href:"https://packit.dev/docs/configuration"},"packit.dev"),".\nCreate file ",(0,o.kt)("inlineCode",{parentName:"p"},".packit.yaml")," with proper content and add it to git."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"generic part example:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"specfile_path: python-your_project_name.spec\n# package project name what correspond to package name in setup.py\nupstream_package_name: your_project_name\n# name what you used as name in specfile (for python packages it starts with python-)\ndownstream_package_name: python-your_project_name\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"copr build enablement part of config - It enables copr builds for stable (without rawhide) fedora releases.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n  - job: copr_build\ntrigger: pull_request\nmetadata:\n  targets:\n    - fedora-stable\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you have static versioning scheme eg. version in spec, setup.py files it should work without next code, in case you are using versioning based on some scm tools, you have to add action to packit yaml (because ",(0,o.kt)("inlineCode",{parentName:"li"},".git")," is not part of tarball with package archive)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'actions:\ncreate-archive:\n  - "python3 setup.py sdist --dist-dir ."\n  - "sh -c \'echo your_project_name-$(python3 setup.py --version).tar.gz\'"\nget-current-version:\n  - "python3 setup.py --version"\n')),(0,o.kt)("p",null,"Then create pull request containing this ",(0,o.kt)("inlineCode",{parentName:"p"},".packit.yaml")," file.\nPackit service should try to do Copr builds for you to prove that Fedora RPM packages build fine."),(0,o.kt)("h3",{id:"increase-version-and-push-it-to-gitpypi-already"},"Increase version and push it to git/PYPI already"),(0,o.kt)("p",null,"It is important to get to consistent state. Previous steps are important do to in this sequence, because it is important for specfile creation."),(0,o.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If the package cannot be build - try to build SRPM package locally via packit CMD line tool: ",(0,o.kt)("inlineCode",{parentName:"li"},"packit srpm"))),(0,o.kt)("h2",{id:"workflow-to-add-your-package-to-fedora"},"Workflow to add your package to Fedora"),(0,o.kt)("h3",{id:"became-fedora-package-maintainer"},"Became Fedora package maintainer"),(0,o.kt)("p",null,"If you are not already Fedora packager, you have to ",(0,o.kt)("a",{parentName:"p",href:"https://fedoraproject.org/wiki/Join_the_package_collection_maintainers"},"become one"),"."),(0,o.kt)("h3",{id:"contribute-new-package-to-fedora"},"Contribute new package to Fedora"),(0,o.kt)("p",null,"Follow ",(0,o.kt)("a",{parentName:"p",href:"https://fedoraproject.org/wiki/New_package_process_for_existing_contributors"},"instruction"),".\nIt is quite complex process to incorporate some package to Fedora."),(0,o.kt)("h3",{id:""}))}d.isMDXComponent=!0}}]);