"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[4635],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=a,d=p["".concat(s,".").concat(h)]||p[h]||m[h]||i;return n?r.createElement(d,o(o({ref:t},u),{},{components:n})):r.createElement(d,o({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},39255:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const i={title:"console.redhat.com provisioning",authors:"ttomecek"},o=void 0,l={unversionedId:"integrations/console",id:"integrations/console",title:"console.redhat.com provisioning",description:"As a followup to our image-builder research, let's have a look at the provisioning service.",source:"@site/research/integrations/console.md",sourceDirName:"integrations",slug:"/integrations/console",permalink:"/research/integrations/console",draft:!1,editUrl:"https://github.com/packit/research/tree/main/research/integrations/console.md",tags:[],version:"current",frontMatter:{title:"console.redhat.com provisioning",authors:"ttomecek"},sidebar:"autogenerated",previous:{title:"Statistics as of September '22",permalink:"/research/integrations/building-srpm-in-copr/september-2022"},next:{title:"Automation of the downstream part of the workflow",permalink:"/research/integrations/downstream/"}},s={},c=[{value:"Links",id:"links",level:2},{value:"Notes",id:"notes",level:2},{value:"Integration",id:"integration",level:2}],u={toc:c},p="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"As a followup to our image-builder research, let's have a look at the provisioning service."),(0,a.kt)("p",null,"This is not thorough at all since the service (and especially the API) is rough\naround the edges (April 2023). I'm assuming it will change substantially in\nthe future."),(0,a.kt)("h2",{id:"links"},"Links"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://console.redhat.com/beta/docs/api/provisioning/v1"},"API Docs")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/RHEnVision/provisioning-backend/tree/8898e972a48387b95b604e612e279ba155682c89/scripts/rest_examples"},"Real API examples"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"I needed these to know what to send to the API"))),(0,a.kt)("li",{parentName:"ul"},"More info in the issue: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/packit/research/issues/167"},"https://github.com/packit/research/issues/167"))),(0,a.kt)("h2",{id:"notes"},"Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"There is no dedicated frontend for the provisioning service: instances are\nlaunched in the Image Builder interface (Launch button next an image).",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Since one can easily inspect instances in the cloud provider's frontend,\nthis is not a problem, just an observation. And probably a subject to\nchange in future how the UI looks like."),(0,a.kt)("li",{parentName:"ul"},"The other interface is the sources setup via Settings in top right corner.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Sources is the mechanism to connect console.rh.c and da cloudz. You need\nto set up a source first in order to start creating instances. In the AWS\nworld, this is an IAM Policy."))))),(0,a.kt)("li",{parentName:"ul"},"The official name is \"Launch\" (API's still called provisioning). Both are\nbeing used. So you're not confused, both reference the same service."),(0,a.kt)("li",{parentName:"ul"},"The API handles only the happy path:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"It doesn't provide errors, I need to write to the team and they check logs."),(0,a.kt)("li",{parentName:"ul"},"#hms-devel on slack, @oezr and @lzap"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://issues.redhat.com/browse/HMS-1646"},"Tracking issue"),", thanks Laura for the nudge"))),(0,a.kt)("li",{parentName:"ul"},"The API creates reservations, which sound like our jobs or tasks."),(0,a.kt)("li",{parentName:"ul"},"Our integration ",(0,a.kt)("em",{parentName:"li"},"needs to")," utilize AWS Launch Templates:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"A preconfiguration of an instance"),(0,a.kt)("li",{parentName:"ul"},"Especially security groups (= firewall)"),(0,a.kt)("li",{parentName:"ul"},"Instance details can't be configured using the API")))),(0,a.kt)("h2",{id:"integration"},"Integration"),(0,a.kt)("p",null,"How we can integrate with it?"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"We should use ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/autoscaling/ec2/userguide/launch-templates.html"},"AWS Launch Templates"),"."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"One cannot configure instance parameters using the provisioning API."),(0,a.kt)("li",{parentName:"ul"},"We also need to be strict about this: we don't want users willy nilly\nchange their instances (i.e. request 64G mem)."),(0,a.kt)("li",{parentName:"ul"},"But at the same time, some users may require specific setups (networking, storage)."),(0,a.kt)("li",{parentName:"ul"},"Make sure to get security group right: the firewall. I.e. by default all\nincoming traffic to the instance from the outside world is blocked = no\nSSH."),(0,a.kt)("li",{parentName:"ul"},"The is exactly what Launch templates are in AWS. ",(0,a.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/autoscaling/ec2/userguide/create-launch-template.html#create-launch-template-for-auto-scaling"},"We should\ncreate"),"\none to use by default and figure out how trusted projects can customize\nthem."),(0,a.kt)("li",{parentName:"ul"},"There needs to be limits."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"We need to wait for the API to mature (see above) in order to fully integrate")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"SSH Keys: we can obtain them from GitHub: should these also be configurable?")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Stopping and terminating the instance: when and how?"))))}m.isMDXComponent=!0}}]);