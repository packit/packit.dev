"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[8756],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(a),h=i,k=c["".concat(l,".").concat(h)]||c[h]||d[h]||o;return a?n.createElement(k,r(r({ref:t},u),{},{components:a})):n.createElement(k,r({ref:t},u))}));function k(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},36350:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const o={title:"Packit Onboarding Guide",sidebar_position:2},r="Packit Onboarding Guide",s={unversionedId:"guide",id:"guide",title:"Packit Onboarding Guide",description:"Let's take a look on how to start using Packit and how to get the most out of it.",source:"@site/docs/guide.md",sourceDirName:".",slug:"/guide",permalink:"/docs/guide",draft:!1,editUrl:"https://github.com/packit/packit.dev/tree/main/docs/guide.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Packit Onboarding Guide",sidebar_position:2},sidebar:"autogenerated",previous:{title:"About Packit",permalink:"/docs/about"},next:{title:"Configuration",permalink:"/docs/configuration/"}},l={},p=[{value:"1. Set up Packit integration",id:"1-set-up-packit-integration",level:2},{value:"GitHub",id:"github",level:3},{value:"How to set up Packit on GitHub",id:"how-to-set-up-packit-on-github",level:4},{value:"Staging instance",id:"staging-instance",level:4},{value:"GitLab",id:"gitlab",level:3},{value:"How to set up Packit on GitLab",id:"how-to-set-up-packit-on-gitlab",level:4},{value:"GitLab Pipelines",id:"gitlab-pipelines",level:5},{value:"Pagure",id:"pagure",level:3},{value:"2. Approval",id:"2-approval",level:2},{value:"3. Configuration",id:"3-configuration",level:2},{value:"Basic configuration",id:"basic-configuration",level:3},{value:"Version handling",id:"version-handling",level:4},{value:"Jobs",id:"jobs",level:3},{value:"Available jobs",id:"available-jobs",level:3},{value:"Actions",id:"actions",level:3},{value:"Users",id:"users",level:3},{value:"How to try that for real",id:"how-to-try-that-for-real",level:3},{value:"RPM builds pass on your laptop",id:"rpm-builds-pass-on-your-laptop",level:4},{value:"Running from the dist-git repository",id:"running-from-the-dist-git-repository",level:5},{value:"The project has successful builds inside the service",id:"the-project-has-successful-builds-inside-the-service",level:4},{value:"Check that Packit works",id:"check-that-packit-works",level:2},{value:"How to re-trigger Packit actions in your pull request?",id:"how-to-re-trigger-packit-actions-in-your-pull-request",level:2},{value:"Packit handles Fedora updates for you.",id:"packit-handles-fedora-updates-for-you",level:4}],u={toc:p},c="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(c,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"packit-onboarding-guide"},"Packit Onboarding Guide"),(0,i.kt)("p",null,"Let's take a look on how to start using Packit and how to get the most out of it."),(0,i.kt)("p",null,"This guide is focused on the service use-case, but Packit is also available as a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/packit/packit/blob/main/README.md"},"CLI tool"),",\nso you can always ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/"},"try things locally")," on your own.\nNote that running tests in Testing farm infrastructure is not currently supported with the CLI tool.\nUnlike the service, CLI uses your own identities when connecting to other service like ",(0,i.kt)("a",{parentName:"p",href:"https://copr.fedorainfracloud.org/"},"Copr"),"\nor ",(0,i.kt)("a",{parentName:"p",href:"https://src.fedoraproject.org/"},"Fedora dist-git"),".\nPackit CLI is ",(0,i.kt)("strong",{parentName:"p"},"NOT")," a client of the Packit GitHub app,\n",(0,i.kt)("inlineCode",{parentName:"p"},"packit")," command  directly interacts with the services."),(0,i.kt)("p",null,"To start using Packit, you need to do three things:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"set up integration (so Packit is notified about your activities and can provide feedback)"),(0,i.kt)("li",{parentName:"ol"},"be approved (self-done mapping of your forge identity to FAS identity, so we know who you are)"),(0,i.kt)("li",{parentName:"ol"},"configure the wanted features")),(0,i.kt)("h2",{id:"1-set-up-packit-integration"},"1. Set up Packit integration"),(0,i.kt)("p",null,"The integration is dependent on the service the upstream project is hosted on.\nIn case you want to use Packit on your downstream repository for downstream jobs\n(",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/downstream/koji_build"},"Koji build")," and ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/downstream/bodhi_update"},"Bodhi update"),"),\nyou don't need to enable anything.\nJust place your config file into the dist-git repository."),(0,i.kt)("p",null,"Here are the supported git-forges:"),(0,i.kt)("h3",{id:"github"},"GitHub"),(0,i.kt)("p",null,"The majority of Packit users host their projects on GitHub, therefore we focus mainly on supporting the GitHub App.\nAll of our workflows are supported and tested on GitHub.\nWe utilize the majority of new GitHub features that can be used in GitHub Apps."),(0,i.kt)("h4",{id:"how-to-set-up-packit-on-github"},"How to set up Packit on GitHub"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Navigate to the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/marketplace/packit-as-a-service"},'"Packit-as-a-Service" GitHub\napplication'),".\n",(0,i.kt)("img",{alt:"Packit GitHub application",src:a(63369).Z,width:"1031",height:"449"})),(0,i.kt)("li",{parentName:"ol"},'Under "Pricing and setup", click "Install it for free".\n',(0,i.kt)("img",{alt:"Packit GitHub application: Plan",src:a(69450).Z,width:"1244",height:"646"})),(0,i.kt)("li",{parentName:"ol"},'Click "Complete order and begin installation".\n',(0,i.kt)("img",{alt:"Packit GitHub application: Order",src:a(6923).Z,width:"1244",height:"585"})),(0,i.kt)("li",{parentName:"ol"},'Install the "Packit-as-a-Service" to repositories of your choice.\n',(0,i.kt)("img",{alt:"Packit GitHub application: Installation",src:a(4503).Z,width:"1404",height:"778"}))),(0,i.kt)("p",null,"Once installed, you will see the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/marketplace/packit-as-a-service"},'"Packit-as-a-Service" GitHub\napplication'),' in your\nproject settings. In the left sidebar, click "Integration & services" and you\nwill see the application displayed there.'),(0,i.kt)("h4",{id:"staging-instance"},"Staging instance"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/apps/packit-as-a-service-stg"},"Packit-as-a-Service-stg")," GitHub App\nruns the latest code. It can be used to verify the latest changes until they get\n(every Tuesday) into the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/marketplace/packit-as-a-service"},"production instance"),"."),(0,i.kt)("p",null,"Few points to consider:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You might want to install both applications together to not disrupt your current workflow."),(0,i.kt)("li",{parentName:"ul"},"Both applications use the same config file, but you can (and have to) use\n",(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/#packit_instances"},(0,i.kt)("inlineCode",{parentName:"a"},"packit_instances")," configuration key")," to\nspecify (globally or per job) which instance handles your jobs -- you can use ",(0,i.kt)("inlineCode",{parentName:"li"},"prod"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"stg")," or both."),(0,i.kt)("li",{parentName:"ul"},"Staging application has fewer resources and can be a bit slower in responses."),(0,i.kt)("li",{parentName:"ul"},"Picking just one instance is required only for ",(0,i.kt)("inlineCode",{parentName:"li"},"koji_build")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"bodhi_update")," jobs since both instances work with\nthe production instances of Fedora systems."),(0,i.kt)("li",{parentName:"ul"},"You will have twice the number of commit statuses for your PRs if you configure both instances."),(0,i.kt)("li",{parentName:"ul"},"Please, let us know when something looks weird or does not work with the staging app."),(0,i.kt)("li",{parentName:"ul"},"You are helping us be sure that we don't break your use-case.")),(0,i.kt)("p",null,"Technicalities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Staging application uses the code from ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," branches of ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/packit/packit-service"},"packit-service"),",\n",(0,i.kt)("a",{parentName:"li",href:"https://github.com/packit/packit"},"packit")," and ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/packit/ogr"},"ogr"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The rebuild is done for each push to ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," branch in ",(0,i.kt)("inlineCode",{parentName:"li"},"packit-service")," and re-deployment is done automatically after few minutes."))),(0,i.kt)("li",{parentName:"ul"},"Production application uses ",(0,i.kt)("inlineCode",{parentName:"li"},"stable")," branches of ",(0,i.kt)("inlineCode",{parentName:"li"},"packit-service")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"packit"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"It is rebuilt on Monday and deployed on Tuesday morning.")))),(0,i.kt)("p",null,"Now, if you want to enjoy the freshest features and help us with the development,\ninstall the app ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apps/packit-as-a-service-stg"},"here"),". Thank you in advance!"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Packit GitHub application: Staging instance",src:a(99656).Z,width:"854",height:"308"})),(0,i.kt)("h3",{id:"gitlab"},"GitLab"),(0,i.kt)("p",null,"GitLab support is mainly experimental and is influenced by the presence of CentOS Stream source-git workflow.\n",(0,i.kt)("strong",{parentName:"p"},"We do not verify")," the functionality of the GitLab support on a day-to-day basis as we do with the GitHub App.\nMost of the code is forge-independent so you can use the very same functionality both on GitHub and GitLab.\nThe only difference is the setup and small UI differences because of the limits of the specific forge.\nYou can use Packit on any GitLab instance, if:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The GitLab instance is publically available."),(0,i.kt)("li",{parentName:"ul"},"Packit has an identity for that instance.\n(Currently only ",(0,i.kt)("inlineCode",{parentName:"li"},"gitlab.com"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"gitlab.freedesktop.org"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"salsa.debian.org")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"gitlab.gnome.org"),",\nbut let us know if you need any other instance to be supported.)")),(0,i.kt)("h4",{id:"how-to-set-up-packit-on-gitlab"},"How to set up Packit on GitLab"),(0,i.kt)("p",null,"GitLab doesn't have an app functionality, and we don't use the\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/integrations/overview.html"},"Integrations"),"\nas it doesn't solve authentication.\nTo enable Packit, you need to manually configure a webhook."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to ",(0,i.kt)("inlineCode",{parentName:"li"},"Settings \u2192 Webhooks")," and add ",(0,i.kt)("a",{parentName:"li",href:"https://prod.packit.dev/api/webhooks/gitlab"},"https://prod.packit.dev/api/webhooks/gitlab"),"\nor ",(0,i.kt)("a",{parentName:"li",href:"https://stg.packit.dev/api/webhooks/gitlab"},"https://stg.packit.dev/api/webhooks/gitlab")," as the ",(0,i.kt)("inlineCode",{parentName:"li"},"URL"),".\n",(0,i.kt)("img",{alt:"GitLab webhooks",src:a(34087).Z,width:"470",height:"340"})),(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("inlineCode",{parentName:"li"},"Push events"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"Comments"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"Issues events"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"Merge request events")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"Release events")," as the ",(0,i.kt)("inlineCode",{parentName:"li"},"Triggers"),".\nDo not provide ",(0,i.kt)("inlineCode",{parentName:"li"},"Secret token")," yet and click ",(0,i.kt)("inlineCode",{parentName:"li"},"Add webhook"),".\nYou should see the created hook at the bottom of the page now.\n",(0,i.kt)("img",{alt:"Setting up webhook",src:a(77634).Z,width:"649",height:"1192"})),(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("inlineCode",{parentName:"li"},"Test")," and for example ",(0,i.kt)("inlineCode",{parentName:"li"},"Push event"),".\nAt the top of the page appears a red ",(0,i.kt)("inlineCode",{parentName:"li"},'Hook executed successfully but returned HTTP 401 "X-Gitlab-Token not in request.headers"'),"."),(0,i.kt)("li",{parentName:"ol"},"Wait a bit and check ",(0,i.kt)("inlineCode",{parentName:"li"},"Issues")," of the project and after a while there should be\na new confidential ",(0,i.kt)("inlineCode",{parentName:"li"},"Packit-Service Authentication")," issue with the instructions how to finish the setup.\n(You need to give Packit user ",(0,i.kt)("inlineCode",{parentName:"li"},"maintainer")," permissions to the project and attach a provided token to the webhooks.)")),(0,i.kt)("h5",{id:"gitlab-pipelines"},"GitLab Pipelines"),(0,i.kt)("p",null,"With some limitations (but tweakability) you can also use Packit as a GitLab pipeline\nusing the Packit's ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli"},"CLI")," from the regularly built\n",(0,i.kt)("a",{parentName:"p",href:"https://quay.io/repository/packit/packit"},(0,i.kt)("inlineCode",{parentName:"a"},"quay.io/packit/packit")," image"),".\nAs you can see in the following example, it's really straightforward and explicit:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'image: quay.io/packit/packit\n\nsrpm_build:\n  stage: build\n  script:\n  - packit srpm\n  artifacts:\n    paths:\n      - "*.src.rpm"\n    expire_in: 1 week\n')),(0,i.kt)("h3",{id:"pagure"},"Pagure"),(0,i.kt)("p",null,"We have rudimentary support for the Pagure instances since they are used in the downstream workflow.\nPackit cannot be set up as a CI (in the same sense as on GitHub or GitLab) on Pagure instances,\nsince the demand for this feature is not significant.\nThe differences between GitHub/GitLab and Pagure APIs would result in many workarounds having to be implemented, if it would be possible at all.\nYou can track the progress in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/packit/packit-service/issues/556"},"related issue")," on GitHub."),(0,i.kt)("h2",{id:"2-approval"},"2. Approval"),(0,i.kt)("p",null,"As a next step, you need to have a valid ",(0,i.kt)("a",{parentName:"p",href:"https://fedoraproject.org/wiki/Account_System"},"Fedora Account System"),"\naccount to be able to start using Packit Service in an upstream project.\nFor GitHub, we have an automated way of self-approval,\nfor other instances, ",(0,i.kt)("a",{parentName:"p",href:"/#contact"},"contact us"),", and we will approve you manually.\nWe require our new users to have ",(0,i.kt)("inlineCode",{parentName:"p"},"GitHub Username")," field set in the FAS account so that we can automatically\ncheck for the match between the ",(0,i.kt)("inlineCode",{parentName:"p"},"GitHub Username")," field in the FAS account and the GitHub account that triggers the verification.\n(If you don't know, where to set this value,\nthe URL looks like this: ",(0,i.kt)("inlineCode",{parentName:"p"},"https://accounts.fedoraproject.org/user/<my-fas-username>/settings/profile/#github"),".)"),(0,i.kt)("p",null,"During the installation, we try to check the FAS account with the same\nusername as the GitHub account that triggers the installation and if the check\nfails, we create a new issue in our\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/packit/notifications/issues/"},"allowlist tracker"),".\n(You will be tagged in that issue and should get a GitHub notification about that.)"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Packit approval issue",src:a(7855).Z,width:"1110",height:"578"})),(0,i.kt)("p",null,"You can provide the FAS account in a comment\nas ",(0,i.kt)("inlineCode",{parentName:"p"},"/packit verify-fas <my-fas-username>")," in the issue we create\nfor your installation. This will trigger the automatic check.\nUntil that, you will get a neutral status with ",(0,i.kt)("inlineCode",{parentName:"p"},"Namespace is not allowed!"),"\nmessage on your commits."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Packit approval issue: add mapping in the FAS settings",src:a(58229).Z,width:"1129",height:"327"}),"\n",(0,i.kt)("img",{alt:"Packit approval issue: add mapping by a comment",src:a(19333).Z,width:"1129",height:"424"})),(0,i.kt)("p",null,"Besides that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If you want to configure builds via Packit,\nyour software needs to comply with ",(0,i.kt)("a",{parentName:"li",href:"https://docs.pagure.org/copr.copr/user_documentation.html#what-i-can-build-in-copr"},"Copr guidelines"),"\nsince we use ",(0,i.kt)("a",{parentName:"li",href:"https://copr.fedorainfracloud.org"},"Fedora Copr")," for the builds.\nTherefore, please, make sure you read them before configuring the ",(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/copr_build"},"Packit build job"),"."),(0,i.kt)("li",{parentName:"ul"},"If you are interested in using ",(0,i.kt)("a",{parentName:"li",href:"https://docs.testing-farm.io/general/0.1/services.html#_red_hat_ranch"},"internal instance of the Testing Farm"),"\nto run your tests in, please, ",(0,i.kt)("a",{parentName:"li",href:"/#contact"},"reach out to us"),", since for this job, an additional approval on our side is needed."),(0,i.kt)("li",{parentName:"ul"},"For retrying the ",(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/copr_build"},"build")," and ",(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/tests"},"test")," jobs via ",(0,i.kt)("inlineCode",{parentName:"li"},"/packit build")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"/packit test")," pull request comments,\nyou need to have write access to the repository or be the author of the pull request."),(0,i.kt)("li",{parentName:"ul"},"Similarly, for retrying the ",(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/propose_downstream"},"propose downstream job")," via ",(0,i.kt)("inlineCode",{parentName:"li"},"/packit propose-downstream")," issue comment,\nyou need to have write access to the repository.")),(0,i.kt)("h2",{id:"3-configuration"},"3. Configuration"),(0,i.kt)("p",null,"Packit uses a configuration file to let Packit know what to do, when to do it and how.\nAs a format, it uses YAML and here are all the valid names:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},".packit.yaml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},".packit.yml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"packit.yaml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"packit.yml"))),(0,i.kt)("p",null,"And where do you need to place this config file?\nWhenever you need to use Packit -- the concept is easy:\nPackit loads the config file from the repository and commit related to the event it reacts to.\nE.g. if Packit reacts to a pull request, it takes config from the HEAD commit of the pull request,\nif Packit works with releases, the release commit is used\nand if Packit works with downstream Koji build,\nthe respective dist-git commit is used."),(0,i.kt)("p",null,"You know how to call this file, where to put it, but what should you fill inside?"),(0,i.kt)("p",null,"In the following parts, we will cover some basic concepts used in the Packit config file.\nMore details can be found on a dedicated ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/"},"configuration page"),"."),(0,i.kt)("h3",{id:"basic-configuration"},"Basic configuration"),(0,i.kt)("p",null,"You need to provide some basic information to let Packit understand your project and package.\nYou can use ",(0,i.kt)("inlineCode",{parentName:"p"},"packit init")," command (when ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/"},"running Packit locally"),") to get a basic structure.\nIt will look like this (name of the package is guessed from the directory name):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# See the documentation for more information:\n# https://packit.dev/docs/configuration/\n\nspecfile_path: package.spec\n\n# add or remove files that should be synced\nfiles_to_sync:\n    - package.spec\n    - .packit.yaml\n\n# name in upstream package repository/registry (e.g. in PyPI)\nupstream_package_name: package\n# downstream (Fedora) RPM package name\ndownstream_package_name: package\n")),(0,i.kt)("p",null,"We know that every project is a bit different and Packit can't guess everything\nso you can (re)define various other options.\nThe full list can be found ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/#top-level-keys"},"here"),"."),(0,i.kt)("h4",{id:"version-handling"},"Version handling"),(0,i.kt)("p",null,"There are a few version-related config options you might need to set:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/#upstream_tag_template"},(0,i.kt)("inlineCode",{parentName:"a"},"upstream_tag_template")),":\nSpecifies a format of upstream tags if it doesn't contain just a version."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/actions/"},(0,i.kt)("inlineCode",{parentName:"a"},"get-current-version")," action"),":\nCommand to get a project version in the current state of the project."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/#release_suffix"},(0,i.kt)("inlineCode",{parentName:"a"},"release_suffix")),":\nUsed to influence release field of artifacts provided by Packit."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/#update_release"},(0,i.kt)("inlineCode",{parentName:"a"},"update_release")),":\nWhether to modify release when creating SRPM.")),(0,i.kt)("h3",{id:"jobs"},"Jobs"),(0,i.kt)("p",null,"Packit's feature set is really wide and does not need to be used as a whole pipeline.\nTo let user decide what and when should run, Packit uses concept of so-called ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs"),".\nEach job represents a feature of Packit. All the jobs are defined under the ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," key.\nFor each job you need to specify the following information:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"job"),": the type of the job, the feature you want Packit to do."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"trigger"),": when the job is run (",(0,i.kt)("inlineCode",{parentName:"li"},"pull_request"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"commit")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"release"),")."),(0,i.kt)("li",{parentName:"ul"},"additional information needed for the job (like what targets to build, for what branch to run the job,...)")),(0,i.kt)("p",null,"(Note that for each job, not all the triggers are supported.)"),(0,i.kt)("p",null,"As an example you can take a look at the following config snippet\n(these are also the default jobs used if you don't set the ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," key):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- job: copr_build\n  trigger: pull_request\n  targets: [fedora-stable]\n\n- job: tests\n  trigger: pull_request\n  targets: [fedora-stable]\n\n- job: propose_downstream\n  trigger: release\n  dist_git_branches:\n    - fedora-all\n")),(0,i.kt)("p",null,"Most of the attributes can be defined both on global level (outside the ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," key)\nor for a single job only (like e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"targets")," in the snippet above).\nMore about this overriding mechanism can be found ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/#overriding-global-parameters"},"here"),".\nAnother useful feature are ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/#aliases"},"aliases")," used to avoid\nhardcoded values that changes when there is a new distribution release."),(0,i.kt)("h3",{id:"available-jobs"},"Available jobs"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/copr_build"},(0,i.kt)("inlineCode",{parentName:"a"},"copr_build")),": An RPM build triggered for pull-requests, new branch commits or releases.\n(Can be used to verify that package is buildable,\nto easily install package including the proposed change\nor to provide long-term Copr repositories.)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/tests"},(0,i.kt)("inlineCode",{parentName:"a"},"tests")),": Test suit using TMT/FMF definition run in the ",(0,i.kt)("a",{parentName:"li",href:"https://docs.testing-farm.io/general/0.1/index.html"},"Testing Farm"),"\n(Can be used as a next step to Copr build or without build at all.)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/upstream_koji_build"},(0,i.kt)("inlineCode",{parentName:"a"},"upstream_koji_build")),": A scratch Koji build triggered for the upstream state of project."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/upstream/propose_downstream"},(0,i.kt)("inlineCode",{parentName:"a"},"propose_downstream")),": For upstream release, Packit prepares a Fedora release.\n(Source is saved to the Lookaside Cache and a dist-git pull-request is created for each configured branch.)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/downstream/koji_build"},(0,i.kt)("inlineCode",{parentName:"a"},"koji_build")),": A downstream Koji build triggered when there is a new dist-git commit in a given branch."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/configuration/downstream/bodhi_update"},(0,i.kt)("inlineCode",{parentName:"a"},"bodhi_update")),": A Bodhi update created for a successfully finished Koji build.")),(0,i.kt)("p",null,"More about the jobs and how to tweak them can be found on a ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration#jobs"},"configuration page"),"."),(0,i.kt)("h3",{id:"actions"},"Actions"),(0,i.kt)("p",null,"Actions are a way how to redefine or tweak the Packit's workflows.\nThese are user-defined commands that can replace a part of Packit's job (e.g. to get version, or to create a tarball)\nor are run in a particular step as a hook (with no action run by default)."),(0,i.kt)("p",null,"Take a look at the tables ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/actions/"},"here")," to know what actions are available for each job."),(0,i.kt)("h3",{id:"users"},"Users"),(0,i.kt)("p",null,"Packit checks if the user has sufficient permissions to complete a job (this depends on the job type).\nFor this reason the profile of a Packit user has to be accessible.\nFor example, on Github this means that the membership of a user to their team has to be public (see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/orgs/%5Borg_name%5D/people/%5Buser_name%5D"},"https://github.com/orgs/[org_name]/people/[user_name]")," )."),(0,i.kt)("h3",{id:"how-to-try-that-for-real"},"How to try that for real"),(0,i.kt)("p",null,"In order to start using Packit, we suggest you ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/#installation"},"install the tooling locally"),". All\nthe logic is baked inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"packit")," command - so once ",(0,i.kt)("inlineCode",{parentName:"p"},"packit srpm")," (the command\nto create a source RPM locally from the current snapshot of the project) starts\npassing for you, it should work inside packit service as well."),(0,i.kt)("h4",{id:"rpm-builds-pass-on-your-laptop"},"RPM builds pass on your laptop"),(0,i.kt)("p",null,"Packit needs an RPM spec file to build your package. The spec file does not\nneed to be included in the upstream repo and can be generated on the fly or\ndownloaded (e.g. from Fedora dist-git).\nPlease check out our ",(0,i.kt)("a",{parentName:"p",href:"/docs/faq"},"FAQ")," to read about some other common questions."),(0,i.kt)("p",null,"You can also read more about the SRPM process\nin ",(0,i.kt)("a",{parentName:"p",href:"/docs/cli/srpm"},"the document")," dedicated to the ",(0,i.kt)("inlineCode",{parentName:"p"},"srpm")," command."),(0,i.kt)("h5",{id:"running-from-the-dist-git-repository"},"Running from the dist-git repository"),(0,i.kt)("p",null,"When you are not allowed or do not want to run packit command from the upstream\ngit repository, you can run commands from the cloned dist-git repository in the\nsame way as you do from upstream.  Make sure, that you specify the\n",(0,i.kt)("inlineCode",{parentName:"p"},"upstream_project_url")," in your configuration."),(0,i.kt)("p",null,"Is your ",(0,i.kt)("inlineCode",{parentName:"p"},"packit srpm")," finally passing? If not, feel free to ",(0,i.kt)("a",{parentName:"p",href:"/#contact"},"reach out to us"),".\nIf yes, let's proceed to the next level."),(0,i.kt)("h4",{id:"the-project-has-successful-builds-inside-the-service"},"The project has successful builds inside the service"),(0,i.kt)("p",null,"If a SRPM can be created locally, all should be good in the service as well.\nThat's the theory. In practice, your laptop and packit service\nenvironment are vastly different. In the service you can specify\nthe requirements with the\n",(0,i.kt)("a",{parentName:"p",href:"https://packit.dev/docs/configuration/#srpm_build_deps"},(0,i.kt)("inlineCode",{parentName:"a"},"srpm_build_deps")," option"),".\nIn any case, feel free to ",(0,i.kt)("a",{parentName:"p",href:"/#contact"},"reach out to us"),"\nif you are having troubles, and we'd be glad to help."),(0,i.kt)("p",null,"As described ",(0,i.kt)("a",{parentName:"p",href:"#jobs"},"above"),", Packit supports various functions in form of jobs you can configure.\nLet's try the most favourite one: Copr build.\nIn order to get RPM builds for every change in your project, you need to add a\nsection ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," inside your .packit.yaml and set up a ",(0,i.kt)("inlineCode",{parentName:"p"},"copr_build")," job to do RPM builds for\nevery change in a PR:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- job: copr_build\n  trigger: pull_request\n  targets:\n  - fedora-all\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"fedora-all")," stands for all currently available Fedora releases."),(0,i.kt)("p",null,"Jobs are nicely described over ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/#jobs"},"here"),"."),(0,i.kt)("p",null,"If you are looking for an inspiration for your .packit.yaml, check ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/packit/packit/blob/main/.packit.yaml"},"packit's\nconfig file"),"\nsince we try to use all the latest features."),(0,i.kt)("h2",{id:"check-that-packit-works"},"Check that Packit works"),(0,i.kt)("p",null,"With the configuration above, Packit will build your changes and provide them as RPMs.\nOnce you create a pull request, Packit will:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Check out the PR."),(0,i.kt)("li",{parentName:"ol"},"Merge it to the target branch (this can be configured by the\n",(0,i.kt)("a",{parentName:"li",href:"https://packit.dev/docs/configuration/#merge_pr_in_ci"},(0,i.kt)("inlineCode",{parentName:"a"},"merge_pr_in_ci")),"\nconfiguration option)."),(0,i.kt)("li",{parentName:"ol"},"Submit a build using the code that results from the merge in the Copr build\nsystem ",(0,i.kt)("a",{parentName:"li",href:"https://copr.fedorainfracloud.org/coprs/packit/"},"in Packit's\nnamespace"),"."),(0,i.kt)("li",{parentName:"ol"},"Report results about the Copr build status to the pull request.")),(0,i.kt)("p",null,"An example of Packit's checks in a pull request:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Packit pull request",src:a(31718).Z,width:"1010",height:"422"})),(0,i.kt)("h2",{id:"how-to-re-trigger-packit-actions-in-your-pull-request"},"How to re-trigger Packit actions in your pull request?"),(0,i.kt)("p",null,"In general, you can put a ",(0,i.kt)("inlineCode",{parentName:"p"},"/packit <job-you-want-to-trigger>")," comment\nto trigger the Packit job manually."),(0,i.kt)("p",null,"So for ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/upstream/copr_build"},"Copr builds"),", Packit is able to trigger new builds based on a pull request comment:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/packit copr-build\n")),(0,i.kt)("p",null,"or the shorter version"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/packit build\n")),(0,i.kt)("p",null,"So whenever you run into a flake or feel like you want to retrigger, just type\nthat comment into the PR and enjoy some fine, fresh builds."),(0,i.kt)("p",null,"For ",(0,i.kt)("a",{parentName:"p",href:"/docs/configuration/upstream/propose_downstream"},(0,i.kt)("inlineCode",{parentName:"a"},"propose_downstream")),", you need to place that comment to any issue."),(0,i.kt)("p",null,"The requirements stated ",(0,i.kt)("a",{parentName:"p",href:"#approval"},"above")," apply, so if you see this message"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Only users with write or admin permissions to the repository can trigger\nPackit-as-a-Service\n")),(0,i.kt)("p",null,"it means the author of the pull request does not have write access to the\nrepository so the build cannot be scheduled. This is a perfect case for\nmaintainers of the repository to post ",(0,i.kt)("inlineCode",{parentName:"p"},"/packit build")," in the PR to get a build."),(0,i.kt)("p",null,"In GitHub Checks interface, it is also possible to re-trigger a specific task just by clicking on ",(0,i.kt)("inlineCode",{parentName:"p"},"Re-run"),"\nfor the particular check:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Re-run GitHub check",src:a(80702).Z,width:"471",height:"198"})),(0,i.kt)("p",null,"Or it is possible to re-trigger every failed task using a pull request comment"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/packit rebuild-failed\n")),(0,i.kt)("p",null,"which builds only failed builds and similar for testing farm"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/packit retest-failed\n")),(0,i.kt)("p",null,"to re-trigger every failed test."),(0,i.kt)("h4",{id:"packit-handles-fedora-updates-for-you"},"Packit handles Fedora updates for you."),(0,i.kt)("p",null,"So you already have a ",(0,i.kt)("inlineCode",{parentName:"p"},"jobs")," section in your config. Let's extend it with another\njobs that will handle the Fedora updates: ",(0,i.kt)("inlineCode",{parentName:"p"},"propose_downstream"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"pull_from_upstream"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"koji_build")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"bodhi_udpate"),".\nThese are explained in detail in our ",(0,i.kt)("a",{parentName:"p",href:"/docs/fedora-releases-guide"},"release guide"),"."),(0,i.kt)("p",null,"And that's about it. Now you should be able to use the core features of the Packit.\nIf you have any questions, feel free to ",(0,i.kt)("a",{parentName:"p",href:"/#contact"},"reach out to us"),"."),(0,i.kt)("p",null,"We welcome all kinds of suggestions to this guide, feel free to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/packit/packit.dev/issues/new"},"open a new issue\nhere"),"."))}d.isMDXComponent=!0},80702:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/github-check-rerun-c22ca93d7511ad081b60ce628090008a.png"},77634:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/set_up_webhook-a604b61054645aaa9fd285e1d2e481ef.png"},34087:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/webhooks-9a177e7d907fa52406a4694e869a5b9f.png"},19333:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_approval_comments-8f447db9d819b533c3e3e5e258642f81.png"},58229:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_approval_fas_settings-fc28ea27f9bcbd26e46804aac6f316ab.png"},7855:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_approval_issue-ee050cb0ba97958fee1216a96a39e35b.png"},63369:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_github_app-ab69d134bd694eb9c0c9716906d3b6cb.png"},4503:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_github_app_installation-969b6cc86f44a6c764c7ecdc61fac368.png"},6923:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_github_app_order-5a591ac7be4f3d7a3eb810c5192c15e0.png"},69450:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_github_app_plan-e461c481f002cd3235396acf12bfd5c6.png"},99656:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_github_app_stg-71d38d78bf3a3870a3c5c0ff7d0eb3e1.png"},31718:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/guide_pr_status-3399ffa41de10392fafe13b825016fc3.png"}}]);