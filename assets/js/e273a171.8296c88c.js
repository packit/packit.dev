"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[6982],{3905:(e,t,i)=>{i.d(t,{Zo:()=>u,kt:()=>g});var a=i(67294);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,a,r=function(e,t){if(null==e)return{};var i,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)i=n[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var i=e.components,r=e.mdxType,n=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(i),m=r,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||n;return i?a.createElement(g,o(o({ref:t},u),{},{components:i})):a.createElement(g,o({ref:t},u))}));function g(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=i.length,o=new Array(n);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<n;p++)o[p]=i[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,i)}m.displayName="MDXCreateElement"},54345:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>n,metadata:()=>l,toc:()=>p});var a=i(87462),r=(i(67294),i(3905));const n={title:"Koji builds",sidebar_position:2},o="job: koji_build",l={unversionedId:"configuration/downstream/koji_build",id:"configuration/downstream/koji_build",title:"Koji builds",description:"Trigger the build in",source:"@site/docs/configuration/downstream/koji_build.md",sourceDirName:"configuration/downstream",slug:"/configuration/downstream/koji_build",permalink:"/docs/configuration/downstream/koji_build",draft:!1,editUrl:"https://github.com/packit/packit.dev/tree/main/docs/configuration/downstream/koji_build.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Koji builds",sidebar_position:2},sidebar:"autogenerated",previous:{title:"Pull from upstream",permalink:"/docs/configuration/downstream/pull_from_upstream"},next:{title:"Bodhi updates",permalink:"/docs/configuration/downstream/bodhi_update"}},s={},p=[{value:"Supported triggers",id:"supported-triggers",level:2},{value:"Required parameters",id:"required-parameters",level:2},{value:"Optional parameters",id:"optional-parameters",level:2},{value:"Example",id:"example",level:3}],u={toc:p},d="wrapper";function c(e){let{components:t,...i}=e;return(0,r.kt)(d,(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"job-koji_build"},(0,r.kt)("inlineCode",{parentName:"h1"},"job: koji_build")),(0,r.kt)("p",null,"Trigger the build in\n",(0,r.kt)("a",{parentName:"p",href:"https://koji.fedoraproject.org/koji/"},"Fedora Koji")," build system\nas a reaction to a new dist-git commit.\nA Packit config file needs to be in the dist-git repository\nto allow this job to be triggered.\nPackit loads the config from the default dist-git branch (usually ",(0,r.kt)("inlineCode",{parentName:"p"},"rawhide"),"). Packit configs on other branches are ignored."),(0,r.kt)("p",null,"The build is triggered only for commits with a spec-file change."),(0,r.kt)("p",null,"By default, only merged pull requests created by Packit are being acted upon so the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.fedoraproject.org/en-US/fesco/Provenpackager_policy/"},"proven packager\nworkflow")," is\npreserved, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/packit/packit-service/issues/1490"},"details\nhere"),". You can override this behaviour by specifying\n",(0,r.kt)("inlineCode",{parentName:"p"},"allowed_pr_authors")," and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"allowed_committers")," in the job configuration (see below). For direct pushes, the committer needs to\nbe specified in the  ",(0,r.kt)("inlineCode",{parentName:"p"},"allowed_committers")," and for merged pull requests the author of the PR needs to be\nspecified in the ",(0,r.kt)("inlineCode",{parentName:"p"},"allowed_pr_authors"),"."),(0,r.kt)("p",null,"There is no UI provided by Packit for the job,\nbut it is visible across Fedora systems (as you can see in the following image).\nThe koji build behaves as it was created manually, and you can utilise\n",(0,r.kt)("a",{parentName:"p",href:"https://apps.fedoraproject.org/notifications/about"},"Fedora Notifications"),"\nto be informed about the builds. Also, you can configure a repository where should we\nopen issues in case of errors during the job via ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#issue_repository"},(0,r.kt)("inlineCode",{parentName:"a"},"issue_repository"))," configuration key."),(0,r.kt)("p",null,"For retriggering the job, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/fedora-releases-guide"},"our release guide"),"."),(0,r.kt)("p",null,"For Koji builds from upstream, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/upstream/upstream_koji_build"},(0,r.kt)("inlineCode",{parentName:"a"},"upstream_koji_build")),"."),(0,r.kt)("admonition",{title:"Downstream configuration template",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can use our ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/downstream_configuration_template"},"downstream configuration template"),"\nfor creating your Packit configuration in dist-git repository.")),(0,r.kt)("admonition",{title:"Automate the setup",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can also use ",(0,r.kt)("a",{parentName:"p",href:"/docs/cli/dist-git/init"},"packit dist-git init")," CLI command to create your\nPackit dist-git configuration.")),(0,r.kt)("h2",{id:"supported-triggers"},"Supported triggers"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"commit")," - reacts to new commits to the specified branch (in dist-git)")),(0,r.kt)("h2",{id:"required-parameters"},"Required parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"dist_git_branches")," - the name of the dist-git branch we want to build for when using ",(0,r.kt)("strong",{parentName:"li"},"commit")," trigger.\nYou can also use the ",(0,r.kt)("a",{parentName:"li",href:"/docs/configuration#aliases"},"aliases provided by Packit"),"\nto not need to change the config file when the new system version is released.")),(0,r.kt)("h2",{id:"optional-parameters"},"Optional parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scratch")," - defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),", use to create scratch (test) builds\ninstead of the real production builds"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"allowed_pr_authors")," - a list of PR authors whose merged pull requests will trigger Koji builds\n(defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"['packit']"),"). As each item of the list you can specify:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"name of a FAS account, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"my-fas")),(0,r.kt)("li",{parentName:"ul"},"name of a group - starting with ",(0,r.kt)("inlineCode",{parentName:"li"},"@"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"@my-sig")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"all_admins")," alias - allowing all users with admin access to the dist-git repo"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"all_committers")," alias - allowing all users with commit access to the dist-git repo"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"allowed_committers")," - a list of committers whose direct pushes to dist-git will trigger Koji builds\n(defaults to an empty list). It is enough to configure the ",(0,r.kt)("inlineCode",{parentName:"li"},"allowed_pr_authors")," option if you want to have Koji builds\ntriggered only by merged pull requests.\nSimilarly to the previous option, as each item of the list you can specify:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"name of a FAS account, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"my-fas")),(0,r.kt)("li",{parentName:"ul"},"name of a group - starting with ",(0,r.kt)("inlineCode",{parentName:"li"},"@"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"@my-sig")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"all_admins")," alias - allowing all users with admin access to the dist-git repo"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"all_committers")," alias - allowing all users with commit access to the dist-git repo")))),(0,r.kt)("h3",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'issue_repository: https://github.com/my-username/packit-notifications\n\njobs:\n- job: koji_build\n  trigger: commit\n  allowed_committers: ["jsmith"]\n  dist_git_branches:\n    - fedora-all\n    - epel-8\n')))}c.isMDXComponent=!0}}]);