"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[52372],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=r,h=d["".concat(p,".").concat(u)]||d[u]||m[u]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},28007:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const o={title:"Propose downstream",sidebar_position:5},i="job: propose_downstream",s={unversionedId:"configuration/upstream/propose_downstream",id:"configuration/upstream/propose_downstream",title:"Propose downstream",description:"Land a new upstream release in Fedora (or CentOS Stream). This job only makes sure the changes",source:"@site/docs/configuration/upstream/propose_downstream.md",sourceDirName:"configuration/upstream",slug:"/configuration/upstream/propose_downstream",permalink:"/docs/configuration/upstream/propose_downstream",draft:!1,editUrl:"https://github.com/packit/packit.dev/tree/main/docs/configuration/upstream/propose_downstream.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Propose downstream",sidebar_position:5},sidebar:"autogenerated",previous:{title:"VM Image Builds",permalink:"/docs/configuration/upstream/vm_image_build"},next:{title:"Downstream jobs",permalink:"/docs/category/downstream-jobs"}},p={},l=[{value:"Supported triggers",id:"supported-triggers",level:2},{value:"Optional parameters",id:"optional-parameters",level:2},{value:"Example",id:"example",level:2},{value:"Retriggering",id:"retriggering",level:2},{value:"Syncing the release to CentOS Stream",id:"syncing-the-release-to-centos-stream",level:2}],c={toc:l},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"job-propose_downstream"},(0,r.kt)("inlineCode",{parentName:"h1"},"job: propose_downstream")),(0,r.kt)("p",null,"Land a new upstream release in Fedora (or CentOS Stream). This job only makes sure the changes\nhappen in dist-git - no builds. A pull request is created as a result."),(0,r.kt)("p",null,"Packit gets the information about the newly created release (not a git tag) from GitHub/GitLab,\nloads the config from the release commit and if there is a ",(0,r.kt)("inlineCode",{parentName:"p"},"propose_downstream")," job\ndefined, the workflow begins. "),(0,r.kt)("p",null,"For enabling the propose downstream job, you need to have\n",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/#1-set-up-packit-integration"},"Packit Service installed"),"\nand have a ",(0,r.kt)("inlineCode",{parentName:"p"},"propose_downstream")," job in the configuration file for the given upstream repository\n(this job is also run by default if there is no ",(0,r.kt)("inlineCode",{parentName:"p"},"jobs")," section\nin the configuration, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/#packit-service-jobs"},"jobs configuration"),").\nThe ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/upstream/propose_downstream"},"propose_downstream job")," should be then configured like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- job: propose_downstream\n  trigger: release\n  dist_git_branches:\n    - main\n")),(0,r.kt)("p",null,"You can adjust the ",(0,r.kt)("inlineCode",{parentName:"p"},"dist_git_branches")," field to include the\ndist-git branches you want to update and also utilise ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/#aliases"},"aliases"),"\ninstead of using hardcoded versions."),(0,r.kt)("p",null,"During proposing a new update, you will get updates of the job status via commit statuses/checks\non the release commit. These will provide links to our dashboard where you can find all the information about\nthe job including the logs. You can also check all propose downstream runs in\n",(0,r.kt)("a",{parentName:"p",href:"https://dashboard.packit.dev/jobs/propose-downstreams"},"this view"),"."),(0,r.kt)("admonition",{title:"CentOS Stream support",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"We newly support ",(0,r.kt)("inlineCode",{parentName:"p"},"propose-downstream")," also for CentOS Stream. The workflow is the same as for Fedora, but there are few\nconfiguration specifics, see ",(0,r.kt)("a",{parentName:"p",href:"#syncing-the-release-to-centos-stream"},"the subsection below"),".")),(0,r.kt)("h2",{id:"supported-triggers"},"Supported triggers"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"release"))),(0,r.kt)("h2",{id:"optional-parameters"},"Optional parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"dist_git_branches")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"a (list of) branches in dist-git where packit should work (defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"main")," which represents ",(0,r.kt)("em",{parentName:"li"},"Fedora Rawhide"),")."),(0,r.kt)("li",{parentName:"ul"},"or a dict whose ",(0,r.kt)("em",{parentName:"li"},"keys")," are the names of the dist-git branches where packit synchronizes release changes\nand the ",(0,r.kt)("em",{parentName:"li"},"values")," are in the form of an empty dict ",(0,r.kt)("inlineCode",{parentName:"li"},"{}")," or as\n",(0,r.kt)("inlineCode",{parentName:"li"},"{fast_forward_merge_into: [other branches names]}"),". In the second example, packit tries to fast forward\nthe changes created for the ",(0,r.kt)("em",{parentName:"li"},"key branch")," in the ",(0,r.kt)("em",{parentName:"li"},"other branches")," opening a pull request for them.")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For how to keep dist-git branches non-divergent\nplease see the details ",(0,r.kt)("a",{parentName:"p",href:"/docs/fedora-releases-guide/non-divergent-dist-git-branches"},"here"),".")),(0,r.kt)("p",null,"  As branch names you can also use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#aliases"},"aliases provided by Packit"),"\nto not need to change the config file when the new system version is released."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/configuration#failure_issue"},(0,r.kt)("strong",{parentName:"a"},"notifications.failure_issue.create"))," - whether to create an upstream issue about failure. Defaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),".")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- job: propose_downstream\n  trigger: release\n- job: propose_downstream\n  trigger: release\n  dist_git_branches:\n    - f39\n")),(0,r.kt)("p",null,"This config would update Fedora Rawhide and Fedora 39 dist-git branches."),(0,r.kt)("h2",{id:"retriggering"},"Retriggering"),(0,r.kt)("p",null,"Users with write or admin permissions to the repository can retrigger an\nupdate via a comment in any open issue in the upstream repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/packit propose-downstream\n")),(0,r.kt)("h2",{id:"syncing-the-release-to-centos-stream"},"Syncing the release to CentOS Stream"),(0,r.kt)("p",null,"Recently, we have implemented support for ",(0,r.kt)("inlineCode",{parentName:"p"},"propose-downstrem")," also for CentOS Stream. This means that you can now configure\nthe upstream release to trigger release syncing the same way as for Fedora to CentOS Stream dist-git repositories\nhosted in ",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.com/redhat/centos-stream/rpms"},"https://gitlab.com/redhat/centos-stream/rpms"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This integration has just been added, so we will be happy if you could help us\ntest it out and improve it! If you come across any issues or have suggestions for improvement,\nplease take a moment to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/packit/packit-service/issues/new"},"report them to us"),".\nWe value general feedback as well, so don't hesitate to ",(0,r.kt)("a",{parentName:"p",href:"/#contact"},"reach out"),"!")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"At the moment, the upload to lookaside cache is being bypassed in the Packit service.\nIf you prefer having this step handled by the automation, you can",(0,r.kt)("br",{parentName:"p"}),"\n","use ",(0,r.kt)("a",{parentName:"p",href:"/docs/cli/propose-downstream"},"Packit CLI")," instead.")),(0,r.kt)("p",null,"To sync the release to CentOS Stream, you currently need to specify the following parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pkg_tool: centpkg")," (the default is ",(0,r.kt)("inlineCode",{parentName:"li"},"fedpkg"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dist_git_branches"),":  a list of dist-git branches, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"c8s"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"c9s"))),(0,r.kt)("p",null,"Besides that, you need to:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"specify the ",(0,r.kt)("a",{parentName:"li",href:"/docs/configuration#packages"},(0,r.kt)("inlineCode",{parentName:"a"},"packages"))," with distinct items for Fedora and CentOS Stream.\nFor each ",(0,r.kt)("inlineCode",{parentName:"li"},"packages")," item, include configuration specifics tailored to the respective environment. This may\nbe setting the ",(0,r.kt)("inlineCode",{parentName:"li"},"pkg_tool")," option and, in case of different specfiles being used in Fedora and CentOS Stream,\nspecifying distinct ",(0,r.kt)("inlineCode",{parentName:"li"},"actions")," for downloading the specfiles as needed."),(0,r.kt)("li",{parentName:"ol"},"specify the particular packages in the jobs (as ",(0,r.kt)("inlineCode",{parentName:"li"},"packages: [my-package-fedora]")," for Fedora-related jobs and\n",(0,r.kt)("inlineCode",{parentName:"li"},"[packages: my-package-centos]")," for CentOS Stream-related job)")),(0,r.kt)("p",null,"Here is an example of such a configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"---\ndownstream_package_name: nispor\nupstream_project_url: https://github.com/nispor/nispor\nissue_repository: https://github.com/nispor/nispor\nupdate_release: false\nupstream_package_name: nispor\nupstream_tag_template: v{version}\ncopy_upstream_release_description: false\n\npackages:\n  nispor-fedora:\n    actions:\n      post-upstream-clone:\n        - wget https://src.fedoraproject.org/rpms/nispor/raw/rawhide/f/nispor.spec\n  nispor-centos:\n    pkg_tool: centpkg\n    actions:\n      post-upstream-clone:\n        - wget https://gitlab.com/redhat/centos-stream/rpms/nispor/-/raw/c9s/nispor.spec\n\njobs:\n  - job: propose_downstream\n    trigger: release\n    packages: [nispor-fedora]\n    dist_git_branches:\n      - fedora\n\n  - job: propose_downstream\n    trigger: release\n    packages: [nispor-centos]\n    dist_git_branches:\n      - c9s\n")))}m.isMDXComponent=!0}}]);