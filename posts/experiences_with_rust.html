<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-posts">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Experiences using Packit for a Rust executable Project | Packit</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://packit.dev/posts/experiences_with_rust"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Experiences using Packit for a Rust executable Project | Packit"><meta data-rh="true" name="description" content="&quot;How absurdly simple!&quot; I cried."><meta data-rh="true" property="og:description" content="&quot;How absurdly simple!&quot; I cried."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-10-10T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/mulkieran"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://packit.dev/posts/experiences_with_rust"><link data-rh="true" rel="alternate" href="https://packit.dev/posts/experiences_with_rust" hreflang="en"><link data-rh="true" rel="alternate" href="https://packit.dev/posts/experiences_with_rust" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://STHKG8EYKZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Packit" href="/opensearch.xml">







<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="Packit Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="Packit Blog Atom Feed">
<link rel="alternate" type="application/json" href="/posts/feed.json" title="Packit Blog JSON Feed">
<link rel="alternate" type="application/rss+xml" href="/posts/weekly/rss.xml" title="Packit Weekly RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/weekly/atom.xml" title="Packit Weekly Atom Feed">
<link rel="alternate" type="application/json" href="/posts/weekly/feed.json" title="Packit Weekly JSON Feed"><link rel="stylesheet" href="/assets/css/styles.3595ad89.css">
<link rel="preload" href="/assets/js/runtime~main.f4d793ce.js" as="script">
<link rel="preload" href="/assets/js/main.e6febfa8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Packit</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/source-git">Source-git</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/development">Development</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/deployment">Deployment</a></li><li><a class="dropdown__link" href="/research">Research</a></li><li><a class="dropdown__link" href="/agile">Agile</a></li><li><a class="dropdown__link" href="/specfile">specfile library</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/posts">Blog Posts</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/posts/weekly">Weekly Updates</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://dashboard.packit.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://status.packit.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/posts/aws-and-image-builder">Customize AWS cloud images with Image Builder and Packit</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/posts/specfile-introduction">Introduction to specfile library</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/posts/experiences_with_rust">Experiences using Packit for a Rust executable Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/posts/verify-sync-release-volunteers">Call for volunteers: help to test us the release syncing using staging instance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/posts/manual-triggering">(Tests) job triggering improvements</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Experiences using Packit for a Rust executable Project</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T00:00:00.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mulkieran" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/mulkieran.png" alt="mulhern"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mulkieran" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">mulhern</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>&quot;How absurdly simple!&quot; I cried.</p><p>&quot;Quite so!&quot; said he, a little nettled. &quot;Every problem becomes very childish when once it is explained to you.&quot;</p><ul><li>Arthur Conan Doyle, &quot;The Adventure of the Dancing Men&quot;</li></ul><p>We have planned for a while to use Packit to generate packages on Copr
on demand for our somewhat complicated Rust executable, stratisd. It
looked like this was going to be challenging, and in a sense it was,
but once the task was completed, it turned out to have been pretty
straightforward.</p><p>The two primary parts of our Stratis project are stratisd, a big,
fairly complicated Rust project which generates multiple distinct Rust
executables and also installs scripts and configuration files and so
forth, and stratis-cli, a relatively simple Python project which
communicates with stratisd over the D-Bus. Our main purpose in getting
on-demand packages of both these projects was not to test the
packaging, although that is a nice thing to do, but to have a
convenient way to do functional testing of the project, frequently
generating a stratisd package from one stratisd pull request and a
stratis-cli package from a matching stratis-cli pull request.</p><p>The Packit team had already obliged us by preparing a Packit
configuration file for our stratis-cli repo, we thus merely had to
figure out how to do the same for stratisd. We already had some
scripts which we could run by hand to make the SRPMs for both projects
so that we could manually send them to Copr so, as it turned out, all
we really needed to do was figure out how to write a Packit
configuration file for stratisd so that Packit would do these tasks
for us. There follows a quick summary of the decisions we made to
solve this problem. Note that our whole and only task was to figure
out how to create the source artifacts and edit the spec file and
to provide these in such a way that Packit could take over from there,
build the SRPM, and carry on to request the Copr builds which provide
the binary packages for testing.</p><p>A Packit configuration is used to set certain configuration <em>options</em>,
to override certain <em>actions</em>, or to define certain <em>hooks</em>. The
available actions and hooks are specific to a given job or set of jobs.
If an action is not
overridden in a project&#x27;s Packit configuration, Packit will execute
its own default action. For example, Packit&#x27;s default for the
create-archive action is just git-archive. Any action can be overridden by
specifying a sequence of commands. For the stratisd Packit
configuration, we found that we had to override the majority of the
actions.</p><p>Note that the <a href="https://github.com/stratis-storage/stratisd/blob/master/.packit.yaml" target="_blank" rel="noopener noreferrer">stratisd Packit configuration file</a> is quite
simple as most of the action is in the <code>create_archive.py</code> script. Some
things to make note of are the following:</p><ol><li><p><code>merge_pr_in_ci</code> is set to false. This prevents Packit from
automatically merging our pull request into its target branch. It has
always been our custom to build from the unmerged branch when testing
PRs and we preferred to do the same in our Packit configuration.</p></li><li><p><code>fix-spec-file</code> contains a dummy echo action. This is how we override
Packit&#x27;s default spec file editing action. Instead of specifying an
override for this action, we use <a href="https://github.com/stratis-storage/ci/blob/master/release_management/create_artifacts.py" target="_blank" rel="noopener noreferrer">our own script</a>, <code>create_artifacts.py</code>, to
edit the spec file as well as to generate the three source artifacts that we
use in this package in the <code>create-archive</code> action.</p></li><li><p><code>create_artifacts.py</code> uses the Packit team&#x27;s <a href="https://github.com/packit/specfile" target="_blank" rel="noopener noreferrer">specfile package</a> to
edit the stratisd specfile. We needed just two modifications: 1. To overwrite the Version field with our preferred version string. 2. To overwrite the Source entries with the names and paths of the
source artifacts.
This requires just one <a href="https://github.com/stratis-storage/ci/blob/master/release_management/_utils.py#L80" target="_blank" rel="noopener noreferrer">very simple function</a> using specfile.</p></li><li><p>In the Packit configuration, the <code>update_release</code> field is set to
false. We prefer to update the Version field in the spec file using
our <code>create_archive.py</code> script, so that the updated version is
recognized as a pre-release version of our current version by
<code>rpmdev-vercmp</code>.</p></li><li><p>We modified our <a href="https://github.com/stratis-storage/stratis-cli/blob/master/.packit.yaml" target="_blank" rel="noopener noreferrer">stratis-cli Packit configuration file</a> to work the
same way as our stratisd one.</p></li></ol><p>In summary, we got the ability to take advantage of the Packit
infrastructure for Copr builds by figuring out how to satisfy its
requirements for the source artifacts and the specfile. Note that our
decisions about how to do this were made based on the scripts we had
already written to generate the SRPMs and the particular requirements
of our project. For example, our release scripts are written in
Python, and we stuck with that choice. That turned out to be handy,
because that allowed us to use the specfile project in our scripts to
edit the spec file. But it would have been possible to write the
artifact creation script in Rust using the cargo xtask pattern just as
well, and to solve the spec file rewriting problem using, e.g., sed.
We overwrote the Version field in the spec file, rather than allowing
Packit to autobump our release number, because our development process
requires us to bump the version in the Cargo.toml (for Rust) and
setup.cfg (for Python) files to the version we will release as soon as
we begin development. These choices and their implementations could be
made differently to support a project with different constraints and
different existing infrastructure.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/packit/packit.dev/tree/main/posts/experiences_with_rust/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/posts/specfile-introduction"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Introduction to specfile library</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/posts/verify-sync-release-volunteers"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Call for volunteers: help to test us the release syncing using staging instance</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guide">Onboarding guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/fedora-releases-guide">Fedora releases guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item">
                  <a href="https://matrix.to/#/#packit:fedora.im?web-instance[element.io]=chat.fedoraproject.org">
                    #packit:fedora.im
                  </a> (Matrix)
                </li><li class="footer__item">
                  <a href="mailto:hello@packit.dev">hello@packit.dev</a>
                </li><li class="footer__item">
                  <a href="https://fosstodon.org/@packit" rel="me">
                    @packit@fosstodon.org
                  </a> (Mastodon)
                </li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/usage">Usage Charts</a></li><li class="footer__item"><a class="footer__link-item" href="/posts">Blog Posts</a></li><li class="footer__item"><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Packit is a Red Hat sponsored free software project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f4d793ce.js"></script>
<script src="/assets/js/main.e6febfa8.js"></script>
</body>
</html>