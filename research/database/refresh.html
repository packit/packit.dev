<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-research docs-doc-id-database/refresh">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Database refresh | Packit</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://packit.dev/research/database/refresh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-research-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-research-current"><meta data-rh="true" property="og:title" content="Database refresh | Packit"><meta data-rh="true" name="description" content="Usecases"><meta data-rh="true" property="og:description" content="Usecases"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://packit.dev/research/database/refresh"><link data-rh="true" rel="alternate" href="https://packit.dev/research/database/refresh" hreflang="en"><link data-rh="true" rel="alternate" href="https://packit.dev/research/database/refresh" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://STHKG8EYKZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Packit" href="/opensearch.xml">





<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="Packit Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="Packit Blog Atom Feed">
<link rel="alternate" type="application/json" href="/posts/feed.json" title="Packit Blog JSON Feed">
<link rel="alternate" type="application/rss+xml" href="/posts/weekly/rss.xml" title="Packit Weekly RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/weekly/atom.xml" title="Packit Weekly Atom Feed">
<link rel="alternate" type="application/json" href="/posts/weekly/feed.json" title="Packit Weekly JSON Feed"><link rel="stylesheet" href="/assets/css/styles.3595ad89.css">
<link rel="preload" href="/assets/js/runtime~main.cb858bf0.js" as="script">
<link rel="preload" href="/assets/js/main.83fc030a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Packit</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/source-git">Source-git</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/development">Development</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/deployment">Deployment</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/research">Research</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/posts">Blog Posts</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/posts/weekly">Weekly Updates</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://dashboard.packit.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://status.packit.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research">Research notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/job_referencing">Job referencing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/making-decisions">Making decisions in our projects</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/automation-tools">Tools/libraries similar or related to the Packit</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tools/libraries similar or related to the Packit&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/celery">Celery</a><button aria-label="Toggle the collapsible sidebar category &#x27;Celery&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/research/category/database">Database</a><button aria-label="Toggle the collapsible sidebar category &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/database/composite-types">Usage of composite type to store the pipelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/database/data-stores">Data stores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/database/postgres-views">Postgres views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/database/refactoring_project_events_and_commit_sha">‹commit_sha› refactor follow-up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/research/database/refresh">Database refresh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/database/whats-in-production-database">Analysis of production DB</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/deployment">Deployment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/deprecation">Deprecation policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/git-notes">Git Notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/integrations">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/automation-of-internal-processes">Automation of internal processes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Automation of internal processes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/monitoring">Monitoring &amp; Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Monitoring &amp; Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/monorepo-support">Monorepos</a><button aria-label="Toggle the collapsible sidebar category &#x27;Monorepos&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/outages">How to manage outages</a><button aria-label="Toggle the collapsible sidebar category &#x27;How to manage outages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/source-git">Source-Git</a><button aria-label="Toggle the collapsible sidebar category &#x27;Source-Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/specfiles">Specfiles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specfiles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/testing">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/user-interface">User Interface</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Interface&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/user-stories">User Stories</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Stories&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/user-experience">User Experience</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Experience&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/workflow-engines">Workflow engines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workflow engines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/research/category/database"><span itemprop="name">Database</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Database refresh</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Database refresh</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usecases">Usecases<a href="#usecases" class="hash-link" aria-label="Direct link to Usecases" title="Direct link to Usecases">​</a></h2><ol><li><p>Show the whole workflow to the user.</p><ul><li>It&#x27;s not clear what it is.</li></ul></li><li><p>For each step, we get:</p><ul><li>previous step</li><li>next steps</li><li>other steps from this group (e.g. other chroots for this build)</li></ul></li><li><p>It is possible to rerun the whole workflow.</p></li><li><p>It is possible to rerun one step (and all the follow-up steps).</p></li><li><p>It is possible to rerun a part of one step (and the follow-up step(s)).</p><ul><li>E.g. one chroot.</li></ul></li><li><p>For project, we get all workflows.</p></li><li><p>For project, we get all events.</p></li><li><p>For event, we get all workflows.</p></li><li><p>For event, we get a project.</p></li><li><p>For each step, we get event.</p></li><li><p>For each step, we get project.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-deal-with-chroots">How to deal with chroots?<a href="#how-to-deal-with-chroots" class="hash-link" aria-label="Direct link to How to deal with chroots?" title="Direct link to How to deal with chroots?">​</a></h2><p>Have a grouping model for all chroots that are related. In Copr, all the chroots are build together and we can group those builds together, but where the grouping does not exists, we can do it manually (=implement the logic on our side).</p><p><img loading="lazy" src="/assets/images/copr_runs-faa20b2dd7f1cae72f5d4d2b732145cd.png" width="820" height="544" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-do-pipelines">How to do pipelines?<a href="#how-to-do-pipelines" class="hash-link" aria-label="Direct link to How to do pipelines?" title="Direct link to How to do pipelines?">​</a></h2><p>We can create a new <code>Step</code> model that will be a middle point between <code>Pipeline</code> and build/test model. The <code>Step</code> model can also track the relation to other <code>Steps</code>. One test/build can be connected to multiple <code>Steps</code>:</p><ul><li>No <code>n:m</code> mapping between <code>Pipeline</code> and test/build model is needed.</li><li>Sharing of test/build is possible if we retrigger part of the workflow.</li></ul><p><img loading="lazy" src="/assets/images/erd-d0707c145ea588ddbe9aba167342fe4f.png" width="833" height="556" class="img_ev3q"></p><p>We just need to make sure that there is only one build/test item linked to one <code>Step</code>:</p><p><img loading="lazy" src="/assets/images/erd_only_one-aa5125c7ff5ecdda313490b30ecc8eb6.png" width="819" height="544" class="img_ev3q"></p><p>Here are the queries we need to do:</p><p><img loading="lazy" src="/assets/images/erd_how_to_get-e357e0c2d228dc4f20b6c4eb33c7caf0.png" width="831" height="552" class="img_ev3q"></p><p>The following two images show the <code>Pipeline</code> from the object point of view.</p><p>The whole pipeline retriggered:</p><p><img loading="lazy" src="/assets/images/object_model_2-4e1e45357fa3dbb9ae16aa07ed9b4f68.png" width="820" height="544" class="img_ev3q"></p><p>Only build retriggered:</p><p><img loading="lazy" src="/assets/images/object_model_1-98eb910aa9ddd0af166a0546e3464b25.png" width="819" height="543" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-runs-ux">Check-runs UX<a href="#check-runs-ux" class="hash-link" aria-label="Direct link to Check-runs UX" title="Direct link to Check-runs UX">​</a></h3><p>Currently, user can request a rerun for a single chroot using the <code>retry</code> button. With that, there will be a new pipeline for each chroot we re-trigger. To be able to group all the retried chroots, we can create a <a href="https://docs.github.com/en/rest/guides/getting-started-with-the-checks-api#check-runs-and-requested-actions" target="_blank" rel="noopener noreferrer">so-called requested action</a> to re-trigger all or all failed. We can also provide choise of the step to re-trigger.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="effectiveness-of-the-queries">Effectiveness of the queries<a href="#effectiveness-of-the-queries" class="hash-link" aria-label="Direct link to Effectiveness of the queries" title="Direct link to Effectiveness of the queries">​</a></h2><p>For the regular queries covering multiple entries that goes across the database, it might be better to create them as one query and not relly on the ORM.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrations">Migrations<a href="#migrations" class="hash-link" aria-label="Direct link to Migrations" title="Direct link to Migrations">​</a></h3><ul><li>For the model that groups the Copr chroots together, we need to group them by <code>copr_id</code> or <code>SRPMBuildModel</code>.</li><li>For the model that groups the Koji chroots together, we need to group them by <code>SRPMBuildModel</code>.
(There is no connection on the Koji level.) For the future, we need to do this ourselves.</li><li>In case of <code>TF</code>, <code>SRPMBuildModel</code> is probably the only way, but this doesn&#x27;t cover the test retrigger and test-only scenario.
We can use <code>TFTTestRunModel.submitted_time</code>.</li><li>When adding the <code>StepModel</code>:<ul><li>Each build/test model will have a new <code>StepModel</code>.</li><li>Currently, <code>RunModel</code> connects builds/tests together -- we can use this info to connect <code>StepModels</code> together.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="projecttriggercommit-related-models">Project/trigger/commit related models<a href="#projecttriggercommit-related-models" class="hash-link" aria-label="Direct link to Project/trigger/commit related models" title="Direct link to Project/trigger/commit related models">​</a></h2><p>Currently:</p><ul><li>Project for trigger not effective to get for multiple entries.</li><li>It&#x27;s more a git reference than a trigger.</li><li>Commit is spread across the models (in build/test models and release).</li></ul><p>Proposal:</p><ul><li>Rename <code>JobTriggerModel</code> to <code>CommitModel</code> and add a <code>commit_hash</code> attribute there.</li><li>Remove the <code>commit_sha</code> attributes from the other classes.</li><li>Connect <code>CommitModel</code> directly to the <code>ProjectModel</code> to make the queries more effective (DAG structure shouldn&#x27;t be a problem: <code>ProjectModel</code> &lt;- <code>PR/Branch/Release</code> &lt;- <code>CommitModel</code> and <code>ProjectModel</code> &lt;- <code>CommitModel</code>).</li><li>Commit can be connected to multiple objects:<ul><li>models in different projects (PR from fork, same branch in multiple repos)</li><li>PR and branch (PR created from the same repo)</li><li>branch and release (release created from this branch)</li><li>-&gt; The easiest solution is probably to have a different model for each occurrence. Grouping can still be done.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="naming">Naming<a href="#naming" class="hash-link" aria-label="Direct link to Naming" title="Direct link to Naming">​</a></h2><ul><li>Remove <code>Model</code> from the names.</li><li><code>RunModel</code> is confusing -&gt; <code>PipelineModel</code>.</li><li>Because of the chroot grouping, we can have a following models (<code>SomethingRunModel</code> groups multiple <code>SomethingModels</code> together.):<ul><li><code>SRPMBuild</code></li><li><code>CoprBuildChroot</code> + <code>CoprBuild</code>.</li><li><code>KojiBuildChroot</code> + <code>KojiBuild</code>.</li><li><code>TestRunChroot</code>+ <code>TestRun</code></li></ul></li><li>For steps, we can use <code>PipelineStepModel</code>.</li><li><code>JobTriggerModel</code> is technically not a trigger, it&#x27;s a project/git reference -&gt; <code>ProjectReferenceModel</code> or <code>CommitModel</code>?</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="downstream-workflow">Downstream workflow<a href="#downstream-workflow" class="hash-link" aria-label="Direct link to Downstream workflow" title="Direct link to Downstream workflow">​</a></h2><ul><li>Both Koji build and Bodhi update can be connected to the dist-git commit.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="follow-up-issues">Follow-up issues<a href="#follow-up-issues" class="hash-link" aria-label="Direct link to Follow-up issues" title="Direct link to Follow-up issues">​</a></h2><ol><li>Naming (remove word model, <code>s/RunModel/Pipeline</code>, new build/test naming):
<a href="https://github.com/packit/packit-service/issues/1326" target="_blank" rel="noopener noreferrer">packit-service#1326</a></li><li>Introduce models for group of chroots.
<a href="https://github.com/packit/packit-service/issues/1327" target="_blank" rel="noopener noreferrer">packit-service#1327</a></li><li>Change <code>JobTriggerModel</code> to <code>CommitModel</code>/<code>ProjectReference</code>, add a <code>commit</code> argument and connect to the project model.
<a href="https://github.com/packit/packit-service/issues/1328" target="_blank" rel="noopener noreferrer">packit-service#1328</a></li><li>Introduce <code>PipelineStep</code> model that connects <code>Pipelines</code> and build/test models (the group ones, not chroot models)
and save the first step in the <code>Pipeline</code> model.
<a href="https://github.com/packit/packit-service/issues/1329" target="_blank" rel="noopener noreferrer">packit-service#1329</a></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/packit/research/tree/main/research/database/refresh.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/research/database/refactoring_project_events_and_commit_sha"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">‹commit_sha› refactor follow-up</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/research/database/whats-in-production-database"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Analysis of production DB</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usecases" class="table-of-contents__link toc-highlight">Usecases</a></li><li><a href="#how-to-deal-with-chroots" class="table-of-contents__link toc-highlight">How to deal with chroots?</a></li><li><a href="#how-to-do-pipelines" class="table-of-contents__link toc-highlight">How to do pipelines?</a><ul><li><a href="#check-runs-ux" class="table-of-contents__link toc-highlight">Check-runs UX</a></li></ul></li><li><a href="#effectiveness-of-the-queries" class="table-of-contents__link toc-highlight">Effectiveness of the queries</a><ul><li><a href="#migrations" class="table-of-contents__link toc-highlight">Migrations</a></li></ul></li><li><a href="#projecttriggercommit-related-models" class="table-of-contents__link toc-highlight">Project/trigger/commit related models</a></li><li><a href="#naming" class="table-of-contents__link toc-highlight">Naming</a></li><li><a href="#downstream-workflow" class="table-of-contents__link toc-highlight">Downstream workflow</a></li><li><a href="#follow-up-issues" class="table-of-contents__link toc-highlight">Follow-up issues</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guide">Onboarding guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/fedora-releases-guide">Fedora releases guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item">
                  <a href="https://chat.fedoraproject.org/#/room/#packit:fedora.im">
                    #packit:fedora.im
                  </a> (Element / Matrix)
                </li><li class="footer__item">
                  <a href="https://libera.chat/">
                    #packit:libera.chat
                  </a> (IRC)
                </li><li class="footer__item">
                  <a href="mailto:hello@packit.dev">hello@packit.dev</a>
                </li><li class="footer__item">
                  <a href="https://fosstodon.org/@packit" rel="me">
                    @packit@fosstodon.org
                  </a> (Mastodon)
                </li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/usage">Usage Charts</a></li><li class="footer__item"><a class="footer__link-item" href="/posts">Blog Posts</a></li><li class="footer__item"><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Packit is a Red Hat sponsored free software project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cb858bf0.js"></script>
<script src="/assets/js/main.83fc030a.js"></script>
</body>
</html>