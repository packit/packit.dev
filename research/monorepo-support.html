<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-research docs-doc-id-monorepo-support/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Monorepos | Packit</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://packit.dev/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://packit.dev/research/monorepo-support"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-research-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-research-current"><meta data-rh="true" property="og:title" content="Monorepos | Packit"><meta data-rh="true" name="description" content="Monorepos store the source code of multiple projects in a single repository."><meta data-rh="true" property="og:description" content="Monorepos store the source code of multiple projects in a single repository."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://packit.dev/research/monorepo-support"><link data-rh="true" rel="alternate" href="https://packit.dev/research/monorepo-support" hreflang="en"><link data-rh="true" rel="alternate" href="https://packit.dev/research/monorepo-support" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://STHKG8EYKZ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Packit" href="/opensearch.xml">







<link rel="alternate" type="application/rss+xml" href="/posts/rss.xml" title="Packit Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/atom.xml" title="Packit Blog Atom Feed">
<link rel="alternate" type="application/json" href="/posts/feed.json" title="Packit Blog JSON Feed">
<link rel="alternate" type="application/rss+xml" href="/posts/weekly/rss.xml" title="Packit Weekly RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/posts/weekly/atom.xml" title="Packit Weekly Atom Feed">
<link rel="alternate" type="application/json" href="/posts/weekly/feed.json" title="Packit Weekly JSON Feed"><link rel="stylesheet" href="/assets/css/styles.3595ad89.css">
<link rel="preload" href="/assets/js/runtime~main.f5ed837e.js" as="script">
<link rel="preload" href="/assets/js/main.5e75f657.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Packit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Packit</b></a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/source-git">Source-git</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/development">Development</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/deployment">Deployment</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/research">Research</a></li><li><a class="dropdown__link" href="/agile">Agile</a></li><li><a class="dropdown__link" href="/specfile">specfile library</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/posts">Blog Posts</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/posts/weekly">Weekly Updates</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://dashboard.packit.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://status.packit.dev/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research">Research notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/job_referencing">Job referencing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/making-decisions">Making decisions in our projects</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/automation-tools">Tools/libraries similar or related to the Packit</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tools/libraries similar or related to the Packit&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/celery">Celery</a><button aria-label="Toggle the collapsible sidebar category &#x27;Celery&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/database">Database</a><button aria-label="Toggle the collapsible sidebar category &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/deployment">Deployment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/deprecation">Deprecation policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/fedora-packages-onboarding">Fedora package candidates for onboarding to downstream automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/research/git-notes">Git Notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/integrations">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/automation-of-internal-processes">Automation of internal processes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Automation of internal processes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/monitoring">Monitoring &amp; Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Monitoring &amp; Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" href="/research/monorepo-support">Monorepos</a><button aria-label="Toggle the collapsible sidebar category &#x27;Monorepos&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/research/monorepo-support/refactoring">Code refactoring</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/outages">How to manage outages</a><button aria-label="Toggle the collapsible sidebar category &#x27;How to manage outages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/source-git">Source-Git</a><button aria-label="Toggle the collapsible sidebar category &#x27;Source-Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/specfiles">Specfiles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specfiles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/testing">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/user-interface">User Interface</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Interface&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/user-stories">User Stories</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Stories&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/category/user-experience">User Experience</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Experience&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/research/workflow-engines">Workflow engines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workflow engines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Monorepos</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Monorepos</h1></header><p>Monorepos store the source code of multiple projects in a single repository.
They are a special use-case from a source-git point of view, because an
upstream monorepo maps to multiple dist-git repositories in the distribution.</p><p>One example for the above is <a href="https://github.com/llvm/llvm-project" target="_blank" rel="noopener noreferrer">LLVM</a> from which code flows into multiple
dist-git repositories in Fedora Linux.</p><p>Currently Packit maps an upstream repo to a single dist-git repo in the
distribution.</p><p>To change this, a mechanism to specify which path(s) in the monorepo to map to
which dist-git repo in the distribution needs to be introduced.</p><p>This could be done by introducing a <code>packages</code> key, to hold a dictionary of
<code>{package_name: package_object}</code>. Package-objects would have keys identical
to the current top-level keys in <code>.packit.yaml</code> and <code>source-git.yaml</code>.</p><p>A package-object could also have a new <code>paths</code> key which is a list of
paths in the monorepo which map to the dist-git repo specified by
<code>downstream_package_name</code>.</p><p>If <code>downstream_package_name</code> is not specified, it would be assumed that the
dist-git repo is called <code>package_name</code>.</p><p>If <code>package.paths</code> is not defined, it defaults to the root of the monorepo,
that is to <code>paths: [&quot;./&quot;]</code>. This probably implies that paths need to be
explicitly defined for each package.</p><p>When processing a package from a monorepo, Packit should operate within these
paths, that is, limit patch generation from Git-history to these paths, and
use only these paths to create the source-tarballs.</p><p><strong>Table of Contents</strong></p><ul><li><a href="#packagepaths-and-subdirectories-to-react-on"><code>package.paths</code> and subdirectories to react on</a></li><li><a href="#packagepaths-and-working-directories"><code>package.paths</code> and working directories</a></li><li><a href="#packages-and-specfile-discovery">Packages and specfile discovery</a></li><li><a href="#impact-on-source-git">Impact on Source-git</a><ul><li><a href="#packit-source-git-init"><code>packit source-git init</code></a></li><li><a href="#packit-source-git-update-dist-git"><code>packit source-git update-dist-git</code></a></li><li><a href="#packit-source-git-update-source-git"><code>packit source-git update-source-git</code></a></li><li><a href="#packit-source-git-status"><code>packit source-git status</code></a></li><li><a href="#hardly">Hardly</a></li></ul></li><li><a href="#impact-on-packit">Impact on Packit</a><ul><li><a href="#packit-init">packit init</a></li><li><a href="#packit-srpm">packit srpm</a></li><li><a href="#packit-copr-build">packit copr-build</a></li><li><a href="#packit-local-build">packit local-build</a></li><li><a href="#packit-build">packit build</a></li><li><a href="#packit-propose-downstream">packit propose-downstream</a></li><li><a href="#packit-sync-from-downstream">packit sync-from-downstream</a></li><li><a href="#packit-create-update">packit create-update</a></li><li><a href="#packit-push-updates">packit push-updates</a></li><li><a href="#packit-status">packit status</a></li><li><a href="#packit-validate-config">packit validate-config</a></li><li><a href="#packit-prepare-sources">packit prepare-sources</a></li></ul></li><li><a href="#impact-on-packit-api">Impact on Packit API</a><ul><li><a href="#internal-design">Internal Design</a></li><li><a href="#inheritance-overriding-of-configuration-keys">Inheritance (Overriding) of Configuration Keys</a></li><li><a href="#impact-on-actions">Impact on Actions</a></li></ul></li><li><a href="#backwards-compatibility">Backwards Compatibility</a></li><li><a href="#open-issues">Open Issues</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="packagepaths-and-subdirectories-to-react-on"><code>package.paths</code> and subdirectories to react on<a href="#packagepaths-and-subdirectories-to-react-on" class="hash-link" aria-label="Direct link to packagepaths-and-subdirectories-to-react-on" title="Direct link to packagepaths-and-subdirectories-to-react-on">​</a></h2><p>In the context of monorepos it becomes handy to be able to filter the events a
service or bot reacts to based in which paths of the monorepo the change
happened.</p><p>This is different from <code>package.paths</code> in the sense that it allows bots and
services to react to a broader (or different) list of paths than the ones
defined to belong to a package.</p><p>To support this a new <code>handle</code> configuration key should be introduced with a
<code>paths</code> sub-key.</p><p><code>handle.paths</code> can be defined on the top-level, in the package-level (although
it&#x27;s not going to be used by the CLI) and on the job-level, and it&#x27;s inherited
as other configuration keys.</p><p><code>handle.paths</code> extends the trigger config option of jobs, by limiting the
validity of the trigger to the paths defined.</p><p>When the <code>packages</code> key is used, jobs have their <code>handle.paths</code> set to the
list of <code>package.paths</code> of the packages to be handled by the job. If
<code>packages</code> is not used, the default value is the path of the root of the Git
repo.</p><p>We could mimic the GitHub syntax here, and also provide <code>handle.ignore_paths</code>
and the exclamation-mark syntax (<code>handle.paths: [!exluded/path, included/path]</code>).</p><p>Providing <code>handle.ignore_paths</code> would be interesting, b/c it could be used to
ignore certain paths for all the packages, by defining its values on the
top-level.</p><p>Note, that a top-level <code>handle.paths</code> would be always overrode by a
<code>package.paths</code>. A <code>!flatten</code> tag would come handy here, too, to allow to use
references to combine lists in YAML.</p><p>Introducing <code>handle.paths</code> would be independent of introducing <code>packages</code>
(monorepo support), as it can be useful even without that, in fact <a href="https://github.com/packit/packit-service/issues/545" target="_blank" rel="noopener noreferrer">it was
requested</a> some long time ago.</p><p>For an example see the <a href="#impact-on-packit">Impact on Packit</a> chapter below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="packagepaths-and-working-directories"><code>package.paths</code> and working directories<a href="#packagepaths-and-working-directories" class="hash-link" aria-label="Direct link to packagepaths-and-working-directories" title="Direct link to packagepaths-and-working-directories">​</a></h2><p>It&#x27;s still not clear if having a <code>working_dir</code> configuration value to set a
custom working directory would be strictly required for monorepo support.
User-defined actions can always <code>cd</code> to the sub-directory of their liking. As
for default actions, it&#x27;s less complicated if they all run from the root of
the Git repository.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="packages-and-specfile-discovery">Packages and specfile discovery<a href="#packages-and-specfile-discovery" class="hash-link" aria-label="Direct link to Packages and specfile discovery" title="Direct link to Packages and specfile discovery">​</a></h2><p>Without <code>packages</code>:</p><ol><li><code>specfile_path</code>, if defined.</li><li><code>&lt;downstream_package_name&gt;.spec</code>, if <code>downstream_package_name</code> set.</li><li>Recursively search the Git repository.</li></ol><p>With <code>packages</code>, for each package:</p><ol><li><code>specfile_path</code>, if defined.</li><li><code>&lt;downstream_package_name&gt;.spec</code> in all the <code>paths</code>, either because
<code>downstream_package_name</code> is defined for the package, or because it
defaults to the name of the package.</li><li>Recursively search all the <code>paths</code> of the package.</li></ol><p>Both in the case of 2. and 3. <code>paths</code> are searched in the order in which they
are defined in the configuration file.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-source-git">Impact on Source-git<a href="#impact-on-source-git" class="hash-link" aria-label="Direct link to Impact on Source-git" title="Direct link to Impact on Source-git">​</a></h2><p>Example:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">upstream_project_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/llvm/llvm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">upstream_ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> llvmorg</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">13.0.0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rc3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">lit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">downstream_package_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">specfile_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .distro/python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lit/python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lit.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> llvm/utils/lit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This could be also used, but it&#x27;s not required here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># patch_generation_ignore_paths:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># - .distro</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sync_changelog</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">files_to_sync</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">src</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .distro/python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lit/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> protect .git*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> protect sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> exclude .gitignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lit</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">13.0.0rc1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//src.fedoraproject.org/repo/pkgs/rpms/python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lit/lit</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">13.0.0rc1/sha512/000a6875d371793ccab7f9c7af0e5906d1d98bb8ff09b297b7f0978c083ec05acb48fd8dbd1647bc9ba6548c8c629cc693219ce8d247877eab14ff250e46cfed/lit</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">13.0.0rc1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the above source-git configuration could be kept in
<code>.distro/source-git.yaml</code>. Downstream files to be synced to dist-git are to be
kept in subdirectories, named according to <code>package_name</code> (the key used in
<code>source-git.yaml</code> to reference the package), in <code>.distro</code>, to keep things
organized.</p><p>An example layout:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.distro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── copr-backend.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── copr-cli.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── copr-frontend.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── source-git.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This way all distribution configs and files would be kept at one place, which
probably is somewhat better than having source-git configuration spread across
the monorepo, in different subdirectories. This setup also allows multiple
paths from the repo mapped to a signle dist-git repo.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-source-git-init"><code>packit source-git init</code><a href="#packit-source-git-init" class="hash-link" aria-label="Direct link to packit-source-git-init" title="Direct link to packit-source-git-init">​</a></h3><p>If the source-git repository to be initialized is a monorepo, then each
dist-git repository specified will also need to one or more subdirectories of
the source-git repository.</p><p>Which makes the whole thing a little bit too complicated ☺</p><p>This complication could be elevated, if <code>packit source-git init</code> would use a
guided (dialog-like) process, instead of taking all its inputs as arguments.</p><p>As an alternative, the command could have a variant where it takes a basic
<code>packages</code> definition to guide the initialization of a source-git monorepo.</p><p>Example <code>packages.yaml</code>:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">downstream_package_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpms/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rawhide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">downstream_package_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpms/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rawhide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">downstream_package_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rpms/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dist_git_branch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rawhide</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Which could be used as:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ packit source-git init --packages packages.yaml v3.0.0 src/copr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or the same could be read from STDIN, with <code>--packages=-</code>:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ packit source-git init --packages</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">- v3.0.0 src/copr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Given that setting up a source-git repository is expected to be a one-time
activity, and that there are not so many projects which are monorepos,
implementing the above should probably have <strong>a low priority for now</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-source-git-update-dist-git"><code>packit source-git update-dist-git</code><a href="#packit-source-git-update-dist-git" class="hash-link" aria-label="Direct link to packit-source-git-update-dist-git" title="Direct link to packit-source-git-update-dist-git">​</a></h3><p><strong>At a minimum</strong>, the command should be updated to support monorepos, and
transform only the content specific to the package from source-git. The
package name (<code>downstream_package_name</code>) to be considered from
<code>.distro/source-git.yaml</code> is the one which matches <code>basename DIST_GIT</code>.</p><p><strong>Going further</strong>, when used with monorepos, this command could be able to
update multiple dist-git repositories. This means, that the <code>DIST_GIT</code>
argument of the command would become <code>DIST_GIT [DIST_GIT...]</code> (one or more
paths to dist-git repositories).</p><p>In the form above, the command would update only the dist-git repositories
which are specified on the command line. If any of the <code>DIST_GIT</code> arguments
specified is not a <code>downstream_package_name</code> in <code>.distro/source-git.yaml</code>, the
command would fail. This would be an early check, before any other change is
done.</p><p>An alternative form of the command could allow updating multiple dist-git
repositories found in <code>--dist-git-store</code>. The command would figure out
dist-git subdirectory names in <code>--dist-git-store</code>, based on
<code>downstream_package_name</code>s found in <code>.distro/source-git.yaml</code>. If any of them
is missing, the command would fail early.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SYNOPSIS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       packit source-git update-dist-git [OPTIONS] --dist-git-store PATH SOURCE_GIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ packit source-git update-dist-git --dist-git-store rpms/ src/copr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-source-git-update-source-git"><code>packit source-git update-source-git</code><a href="#packit-source-git-update-source-git" class="hash-link" aria-label="Direct link to packit-source-git-update-source-git" title="Direct link to packit-source-git-update-source-git">​</a></h3><p>Let&#x27;s not change the interface of this command and don&#x27;t support the usecase
to update a single source-git monorepo from multiple dist-git repositories in
order to avoid complications. Expect that multiple commands are going to be
executed if updates need to be taken from multiple dist-git repositories.</p><p>On the other hand, the command needs to be updated to support a source-git
repo as a target when the source-git repo is a monorepo. In this case only the
paths of the sub-package need to be considered during the update. <code>DIST_GIT</code>
should match one of the <code>downstream_package_name</code>s in <code>.distro/source-git.yaml</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-source-git-status"><code>packit source-git status</code><a href="#packit-source-git-status" class="hash-link" aria-label="Direct link to packit-source-git-status" title="Direct link to packit-source-git-status">​</a></h3><p>The command should check the sync status of a sub-package from a source-git
monorepo and the corresponding dist-git repo. <code>downstream_package_name</code> should
match <code>basename DIST_GIT</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hardly">Hardly<a href="#hardly" class="hash-link" aria-label="Direct link to Hardly" title="Direct link to Hardly">​</a></h3><p>When opening an MR in a source-git monorepo, Hardly should figure out which
dist-git packages are going to be impacted by the change (by looking at
<code>package.paths</code>), and open mirror-MRs in the dist-git repositories of those
packages.</p><p>CI results from all mirror-MRs should be synced back to the source-git MR.</p><p><strong>Open question</strong>: Is the behavior above good enough? Can there be source-git
changes happening outside the package paths, but which influence the dist-git
content of the package?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-packit">Impact on Packit<a href="#impact-on-packit" class="hash-link" aria-label="Direct link to Impact on Packit" title="Direct link to Impact on Packit">​</a></h2><p>All things that follow assume that <a href="https://github.com/packit/packit/issues/1515" target="_blank" rel="noopener noreferrer">the <code>metadata</code> key was dropped</a>.</p><p>Additionally to what was presented above, a new property of job-objects in
<code>.packit.yaml</code> needs to be introduced, to be used to specify which packages
the job should handle when triggered. The property would be called <code>packages</code>
and would be a list of package-object names. If a job-object has no such key,
all packages of a monorepo should be handled.</p><p>Example:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">handle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ignore_paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">upstream_project_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//pagure.io/copr/copr.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">copr-backend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># defining &#x27;specfile_path&#x27; would be optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">specfile_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> backend/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">copr-frontend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">specfile_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> frontend/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frontend.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">copr-cli</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">specfile_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cli/copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli.spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr_build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trigger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pull_request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fedora</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> epel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr_build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trigger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pull_request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fedora</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> copr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> common</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-init">packit init<a href="#packit-init" class="hash-link" aria-label="Direct link to packit init" title="Direct link to packit init">​</a></h3><p>No changes are required for this command. <code>.packit.yaml</code> is expected to be
crafted manually if the upstream repository is a monorepo.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-srpm">packit srpm<a href="#packit-srpm" class="hash-link" aria-label="Direct link to packit srpm" title="Direct link to packit srpm">​</a></h3><p>The command should receive a new optional argument, <code>[PACKAGE...]</code>, to define
zero or more packages for which an SRPM should be built.</p><p>If no such argument is present, an SRPM should be produced for all packages
defined in <code>.packit.yaml</code>. When one or more such arguments are present, and
SRPM should be produced only for the packages specified.</p><p>The command should fail if any of the <code>PACKAGE</code> argument has no corresponding
<code>downstream_package_name</code> in <code>.packit.yaml</code>.</p><p>When a <code>PACKAGE</code> argument is used <code>PATH_OR_URL</code> is expected to be explicitly
provided. Example:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/user/src/copr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ packit srpm </span><span class="token builtin class-name">.</span><span class="token plain"> backend</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-copr-build">packit copr-build<a href="#packit-copr-build" class="hash-link" aria-label="Direct link to packit copr-build" title="Direct link to packit copr-build">​</a></h3><p>Similar to <code>packit srpm</code>, the command should receive a new optional
<code>[PACKAGE...]</code> argument, which should allow to trigger Copr-builds only to
those the packages specified.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-local-build">packit local-build<a href="#packit-local-build" class="hash-link" aria-label="Direct link to packit local-build" title="Direct link to packit local-build">​</a></h3><p>Similar to <code>packit srpm</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-build">packit build<a href="#packit-build" class="hash-link" aria-label="Direct link to packit build" title="Direct link to packit build">​</a></h3><p>Similar to <code>packit srpm</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-propose-downstream">packit propose-downstream<a href="#packit-propose-downstream" class="hash-link" aria-label="Direct link to packit propose-downstream" title="Direct link to packit propose-downstream">​</a></h3><p>Similar to <code>packit srpm</code>. When a <code>PACKAGE</code> argument is specified updates are
proposed only for those packages, and specifying <code>PATH_OR_URL</code> and <code>VERSION</code>
becomes mandatory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-sync-from-downstream">packit sync-from-downstream<a href="#packit-sync-from-downstream" class="hash-link" aria-label="Direct link to packit sync-from-downstream" title="Direct link to packit sync-from-downstream">​</a></h3><p>This is copying synced files from downstream to upstream.</p><p>The command needs to support the same <code>[PACKAGE...]</code> argument as
<code>packit srpm</code>, and sync from only the specified dist-git repositories, when at
least on of such an arguments is specified.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-create-update">packit create-update<a href="#packit-create-update" class="hash-link" aria-label="Direct link to packit create-update" title="Direct link to packit create-update">​</a></h3><p>Similar to <code>packit srpm</code>. When a <code>PACKAGE</code> argument is specified updates are
created only for the specified packages.</p><p>There should be <strong>one update created</strong>, including all (or the specified
subset) of packages (packages from a monorepo are usually <a href="https://bodhi.fedoraproject.org/updates/FEDORA-2022-8f02fc9461" target="_blank" rel="noopener noreferrer">released as a batch</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-push-updates">packit push-updates<a href="#packit-push-updates" class="hash-link" aria-label="Direct link to packit push-updates" title="Direct link to packit push-updates">​</a></h3><p>This command works with updates. Currently if no option is provided updates
which are in testing and belong to the package are pushed.</p><p>In a monorepo, if no argument is provided, all updates in testing which
contain any of the packages in the monorepo should be pushed.</p><p>If one or more <code>PACKAGES</code> are specified, all updates in testing which could be
pushed and contain any of the packages specified should be pushed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-status">packit status<a href="#packit-status" class="hash-link" aria-label="Direct link to packit status" title="Direct link to packit status">​</a></h3><p>The command should display status for all packages in a monorepo, or if one
more <code>PACKAGES</code> are specified, status should be displayed for those packages.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-validate-config">packit validate-config<a href="#packit-validate-config" class="hash-link" aria-label="Direct link to packit validate-config" title="Direct link to packit validate-config">​</a></h3><p>Check if the paths specified in <code>package.paths</code> do exist in the monorepo.</p><p>Check if the package names (<code>downstream_package_name</code>) are correct and indeed
exist in the distribution. See <a href="https://github.com/packit/packit/issues/88" target="_blank" rel="noopener noreferrer">packit/packit#88</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="packit-prepare-sources">packit prepare-sources<a href="#packit-prepare-sources" class="hash-link" aria-label="Direct link to packit prepare-sources" title="Direct link to packit prepare-sources">​</a></h3><p>The command should be updated similar to <code>packit srpm</code>, so that it&#x27;s possible
to limit changes only to select packages.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-packit-api">Impact on Packit API<a href="#impact-on-packit-api" class="hash-link" aria-label="Direct link to Impact on Packit API" title="Direct link to Impact on Packit API">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal-design">Internal Design<a href="#internal-design" class="hash-link" aria-label="Direct link to Internal Design" title="Direct link to Internal Design">​</a></h3><p>With monorepos needs to be taught to map a single upstream repository
(<code>PackitAPI.up</code>) to multiple dist-git/downstream repositories. This means that
<code>PackitAPI.dg</code> should become a dictionary holding the objects for each
dist-git repository.</p><p>In order to make the transition easier, we could keep <code>.dg</code> as it is, and make
it to return the dist-git repo for the first (and only) package. If there are
more packages defined, an exception should be raised. This way parts of the
API and CLI which were not yet updated to support monorepos, could continue to
work, but would fail if used with a monorepo configuration specifying multiple
packages.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inheritance-overriding-of-configuration-keys">Inheritance (Overriding) of Configuration Keys<a href="#inheritance-overriding-of-configuration-keys" class="hash-link" aria-label="Direct link to Inheritance (Overriding) of Configuration Keys" title="Direct link to Inheritance (Overriding) of Configuration Keys">​</a></h3><p>One can override configuration defined on the top-level of <code>.packit.yaml</code> in a
package-object. That is, all top-level values are inherited by package-objects.</p><p>Configuration values can be further overridden in job objects, but only for
the packages the job references (if any.)</p><p>A (not very meaningful) example:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">srpm_build_deps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">setuptools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subpackage1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> package1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">srpm_build_deps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">setuptools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">packaging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">subpackage2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> package2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr_build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trigger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pull_request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">srpm_build_deps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> python3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">setuptools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cowsay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fedora</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copr_build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trigger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> subpackage1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> fedora</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> epel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above when building PRs in Copr, the <code>srpm_build_deps</code> defined
in the job would be used for both packages.</p><p>On the other hand, when building releases in Copr, only <code>subpackage1</code> is going
to be built, and the <code>srpm_build_deps</code> will be the ones defined for the
package in the <code>packages</code> section.</p><p>The example above could be made more useful if extending lists would be
supported by Packit. (YAML doesn&#x27;t support this, one gets nested lists when
using references in lists.)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-actions">Impact on Actions<a href="#impact-on-actions" class="hash-link" aria-label="Direct link to Impact on Actions" title="Direct link to Impact on Actions">​</a></h3><p>Because actions can now be defined on the top-level, package-level and
job-level, one might ask, in what path these should be executed.</p><p>Because a package can map to multiple sub-paths in the monorepo, the most
sensible thing to do is to keep it simple and execute each action at the
top-level, even if the action is defined on a job- or package-level. If
needed, user-defined actions can still <code>cd</code> into a preferred sub-directory.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility">Backwards Compatibility<a href="#backwards-compatibility" class="hash-link" aria-label="Direct link to Backwards Compatibility" title="Direct link to Backwards Compatibility">​</a></h2><p>For backwards compatibility: if the top-level <code>packages</code> key is missing,
source-git configuration is read as currently is.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-issues">Open Issues<a href="#open-issues" class="hash-link" aria-label="Direct link to Open Issues" title="Direct link to Open Issues">​</a></h2><ul><li>TODO Can archives stored in the dist-git repositories mapped to one or more
paths in the upstream repo?</li><li>TODO Is support needed to have different packages generated from different
git refs? (This would defy the point in having a monorepo, but some might
require it, for example <a href="https://pagure.io/copr/copr" target="_blank" rel="noopener noreferrer">Copr</a>.)</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/packit/research/tree/main/research/monorepo-support/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/research/monitoring/metrics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Metrics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/research/monorepo-support/refactoring"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Code refactoring</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#packagepaths-and-subdirectories-to-react-on" class="table-of-contents__link toc-highlight"><code>package.paths</code> and subdirectories to react on</a></li><li><a href="#packagepaths-and-working-directories" class="table-of-contents__link toc-highlight"><code>package.paths</code> and working directories</a></li><li><a href="#packages-and-specfile-discovery" class="table-of-contents__link toc-highlight">Packages and specfile discovery</a></li><li><a href="#impact-on-source-git" class="table-of-contents__link toc-highlight">Impact on Source-git</a><ul><li><a href="#packit-source-git-init" class="table-of-contents__link toc-highlight"><code>packit source-git init</code></a></li><li><a href="#packit-source-git-update-dist-git" class="table-of-contents__link toc-highlight"><code>packit source-git update-dist-git</code></a></li><li><a href="#packit-source-git-update-source-git" class="table-of-contents__link toc-highlight"><code>packit source-git update-source-git</code></a></li><li><a href="#packit-source-git-status" class="table-of-contents__link toc-highlight"><code>packit source-git status</code></a></li><li><a href="#hardly" class="table-of-contents__link toc-highlight">Hardly</a></li></ul></li><li><a href="#impact-on-packit" class="table-of-contents__link toc-highlight">Impact on Packit</a><ul><li><a href="#packit-init" class="table-of-contents__link toc-highlight">packit init</a></li><li><a href="#packit-srpm" class="table-of-contents__link toc-highlight">packit srpm</a></li><li><a href="#packit-copr-build" class="table-of-contents__link toc-highlight">packit copr-build</a></li><li><a href="#packit-local-build" class="table-of-contents__link toc-highlight">packit local-build</a></li><li><a href="#packit-build" class="table-of-contents__link toc-highlight">packit build</a></li><li><a href="#packit-propose-downstream" class="table-of-contents__link toc-highlight">packit propose-downstream</a></li><li><a href="#packit-sync-from-downstream" class="table-of-contents__link toc-highlight">packit sync-from-downstream</a></li><li><a href="#packit-create-update" class="table-of-contents__link toc-highlight">packit create-update</a></li><li><a href="#packit-push-updates" class="table-of-contents__link toc-highlight">packit push-updates</a></li><li><a href="#packit-status" class="table-of-contents__link toc-highlight">packit status</a></li><li><a href="#packit-validate-config" class="table-of-contents__link toc-highlight">packit validate-config</a></li><li><a href="#packit-prepare-sources" class="table-of-contents__link toc-highlight">packit prepare-sources</a></li></ul></li><li><a href="#impact-on-packit-api" class="table-of-contents__link toc-highlight">Impact on Packit API</a><ul><li><a href="#internal-design" class="table-of-contents__link toc-highlight">Internal Design</a></li><li><a href="#inheritance-overriding-of-configuration-keys" class="table-of-contents__link toc-highlight">Inheritance (Overriding) of Configuration Keys</a></li><li><a href="#impact-on-actions" class="table-of-contents__link toc-highlight">Impact on Actions</a></li></ul></li><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">Backwards Compatibility</a></li><li><a href="#open-issues" class="table-of-contents__link toc-highlight">Open Issues</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guide">Onboarding guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/fedora-releases-guide">Fedora releases guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item">
                  <a href="https://matrix.to/#/#packit:fedora.im?web-instance[element.io]=chat.fedoraproject.org">
                    #packit:fedora.im
                  </a> (Matrix)
                </li><li class="footer__item">
                  <a href="mailto:hello@packit.dev">hello@packit.dev</a>
                </li><li class="footer__item">
                  <a href="https://fosstodon.org/@packit" rel="me">
                    @packit@fosstodon.org
                  </a> (Mastodon)
                </li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/usage">Usage Charts</a></li><li class="footer__item"><a class="footer__link-item" href="/posts">Blog Posts</a></li><li class="footer__item"><a href="https://github.com/packit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Packit is a Red Hat sponsored free software project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f5ed837e.js"></script>
<script src="/assets/js/main.5e75f657.js"></script>
</body>
</html>